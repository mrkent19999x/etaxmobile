<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéØ Demo Access - eTax Mobile</title>
  
  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Tahoma', 'Microsoft Sans Serif', 'Arial', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .demo-container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 500px;
      overflow: hidden;
      text-align: center;
    }

    .header {
      background: #b71c1c;
      color: white;
      padding: 30px;
    }

    .header h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .header p {
      opacity: 0.9;
      font-size: 14px;
    }

    .content {
      padding: 40px 30px;
    }

    .loading {
      color: #666;
      font-size: 16px;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #b71c1c;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .success {
      color: #28a745;
    }

    .error {
      color: #dc3545;
    }

    .btn {
      background: #b71c1c;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s;
    }

    .btn:hover {
      background: #9a0e0e;
      transform: translateY(-2px);
    }

    .user-info {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }

    .user-info h3 {
      color: #333;
      margin-bottom: 10px;
    }

    .user-info p {
      color: #666;
      margin: 5px 0;
    }
  </style>
</head>

<body>
  <div class="demo-container">
    <div class="header">
      <h1>üéØ DEMO ACCESS</h1>
      <p>Truy c·∫≠p demo h·ªá th·ªëng eTax Mobile</p>
    </div>

    <div class="content" id="content">
      <div class="loading">
        <div class="spinner"></div>
        ƒêang ki·ªÉm tra quy·ªÅn truy c·∫≠p...
      </div>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD_rJgBFgBulheVenQUE2KXr4PBpSpTCxw",
      authDomain: "etax-7fbf8.firebaseapp.com",
      databaseURL: "https://etax-7fbf8-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "etax-7fbf8",
      storageBucket: "etax-7fbf8.appspot.com",
      messagingSenderId: "1030026724634",
      appId: "1:1030026724634:web:d76f5f9dad43bad6fd58a3",
      measurementId: "G-YS5DLECJE6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Get demo link from URL path
    function getDemoLinkFromURL() {
      const path = window.location.pathname;
      const match = path.match(/\/demo\/([A-Z0-9]+)/i);
      return match ? match[1] : null;
    }

    // Check demo access
    async function checkDemoAccess() {
      const demoLink = getDemoLinkFromURL();
      const content = document.getElementById('content');

      if (!demoLink) {
        content.innerHTML = `
          <div class="error">
            <h3>‚ùå Link kh√¥ng h·ª£p l·ªá</h3>
            <p>Kh√¥ng t√¨m th·∫•y m√£ demo trong URL</p>
            <p style="margin-top: 15px; font-size: 14px; color: #999;">
              URL ƒë√∫ng: yoursite.com/demo/ABC123XYZ
            </p>
          </div>
        `;
        return;
      }

      try {
        // Search for user with this demo link
        const usersSnapshot = await db.ref('users').once('value');
        const users = usersSnapshot.val() || {};
        
        let foundUser = null;
        for (const [mst, userData] of Object.entries(users)) {
          if (userData.demoLink === demoLink && userData.status === 'active') {
            foundUser = { mst, ...userData };
            break;
          }
        }

        if (!foundUser) {
          content.innerHTML = `
            <div class="error">
              <h3>‚ùå Link ƒë√£ h·∫øt h·∫°n</h3>
              <p>Demo link n√†y kh√¥ng c√≤n hi·ªáu l·ª±c ho·∫∑c ƒë√£ b·ªã h·ªßy</p>
              <p style="margin-top: 15px; font-size: 14px; color: #999;">
                Vui l√≤ng li√™n h·ªá admin ƒë·ªÉ ƒë∆∞·ª£c c·∫•p link m·ªõi
              </p>
            </div>
          `;
          return;
        }

        // Valid demo link found
        content.innerHTML = `
          <div class="success">
            <h3>‚úÖ Demo Link h·ª£p l·ªá</h3>
          </div>
          
          <div class="user-info">
            <h3>Th√¥ng tin Demo</h3>
            <p><strong>C√¥ng ty:</strong> ${foundUser.companyName || 'N/A'}</p>
            <p><strong>T√™n:</strong> ${foundUser.lastName} ${foundUser.firstName}</p>
            <p><strong>MST:</strong> ${foundUser.mst}</p>
          </div>
          
          <button class="btn" onclick="enterDemo('${foundUser.mst}')">
            üîë Ti·∫øn h√†nh ƒêƒÉng nh·∫≠p
          </button>
          
          <p style="margin-top: 20px; font-size: 14px; color: #666;">
            B·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn t·ªõi trang ƒëƒÉng nh·∫≠p ri√™ng
          </p>
        `;

        // Log demo access
        await db.ref('demoAccessLogs').push({
          demoLink: demoLink,
          userMST: foundUser.mst,
          accessTime: Date.now(),
          userAgent: navigator.userAgent,
          ip: 'demo-access'
        });

      } catch (error) {
        console.error('‚ùå Error checking demo access:', error);
        content.innerHTML = `
          <div class="error">
            <h3>‚ùå L·ªói h·ªá th·ªëng</h3>
            <p>Kh√¥ng th·ªÉ ki·ªÉm tra quy·ªÅn truy c·∫≠p</p>
            <p style="margin-top: 15px; font-size: 14px; color: #999;">
              ${error.message}
            </p>
          </div>
        `;
      }
    }

    // Enter demo with user data
    function enterDemo(mst) {
      // Set demo user info in localStorage
      const demoUserInfo = {
        mst: mst,
        isDemoMode: true,
        demoAccessTime: Date.now()
      };
      
      localStorage.setItem('etax_demo_user', JSON.stringify(demoUserInfo));
      
      // Redirect to login page with demo mode
      window.location.href = `login.html?demo=true&mst=${mst}`;
    }

    // Initialize page
    window.addEventListener('DOMContentLoaded', function() {
      console.log('üéØ Demo access page loaded');
      checkDemoAccess();
    });
  </script>
</body>
</html>