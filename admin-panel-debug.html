<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ›¡ï¸ ADMIN PANEL - DEBUG MODE</title>
  
  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Tahoma', 'Microsoft Sans Serif', 'Arial', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .debug-header {
      background: #dc3545;
      color: white;
      padding: 10px 20px;
      text-align: center;
      font-weight: bold;
    }

    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
    }

    .admin-sidebar {
      background: white;
      border-radius: 15px;
      padding: 20px;
      height: fit-content;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      margin-bottom: 5px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      color: #666;
    }

    .menu-item:hover,
    .menu-item.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .admin-content {
      background: white;
      border-radius: 15px;
      padding: 20px;
      min-height: 500px;
    }

    .debug-panel {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #007bff;
    }

    .error-panel {
      border-left-color: #dc3545;
      background: #f8d7da;
    }

    .success-panel {
      border-left-color: #28a745;
      background: #d4edda;
    }

    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }

    .console-output {
      background: #343a40;
      color: #28a745;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="debug-header">
    ğŸ› DEBUG MODE - ADMIN PANEL (This will help us find the issue)
  </div>

  <div class="admin-container">
    <!-- Sidebar -->
    <div class="admin-sidebar">
      <h3>ğŸ›ï¸ Menu Debug</h3>
      
      <div class="menu-item active" onclick="debugShowDashboard()">
        ğŸ“Š Dashboard (Debug)
      </div>
      
      <div class="menu-item" onclick="debugShowNotifications()">
        ğŸ“¢ Notifications (Debug)
      </div>
      
      <div class="menu-item" onclick="debugShowUsers()">
        ğŸ‘¥ Users (Debug)
      </div>
      
      <div class="menu-item" onclick="debugShowContent()">
        ğŸ“„ Content (Debug)
      </div>
      
      <div class="menu-item" onclick="debugVisualEditor()">
        ğŸ¨ Visual Editor (Debug)
      </div>

      <hr style="margin: 20px 0;">
      
      <h4>ğŸ”§ Debug Tools</h4>
      <button onclick="checkSession()">Check Session</button>
      <button onclick="checkFirebase()">Check Firebase</button>
      <button onclick="checkFunctions()">Check Functions</button>
      <button onclick="clearConsole()">Clear Console</button>
    </div>

    <!-- Content -->
    <div class="admin-content">
      <div id="debugInfo" class="debug-panel">
        <h4>ğŸ” Debug Information</h4>
        <p>Loading debug info...</p>
      </div>

      <div id="contentArea">
        <h2>ğŸ›¡ï¸ Admin Panel Debug Mode</h2>
        <p>Click menu items hoáº·c debug buttons Ä‘á»ƒ test functionality.</p>
      </div>

      <div class="debug-panel">
        <h4>ğŸ“ Console Output</h4>
        <div id="consoleOutput" class="console-output">
          Waiting for logs...
        </div>
      </div>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD_rJgBFgBulheVenQUE2KXr4PBpSpTCxw",
      authDomain: "etax-7fbf8.firebaseapp.com",
      databaseURL: "https://etax-7fbf8-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "etax-7fbf8",
      storageBucket: "etax-7fbf8.appspot.com",
      messagingSenderId: "1030026724634",
      appId: "1:1030026724634:web:d76f5f9dad43bad6fd58a3",
      measurementId: "G-YS5DLECJE6"
    };

    let db;
    const logs = [];

    // Console capture
    const originalLog = console.log;
    const originalError = console.error;
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      logs.push('[LOG] ' + args.join(' '));
      updateConsole();
    };
    
    console.error = function(...args) {
      originalError.apply(console, args);
      logs.push('[ERROR] ' + args.join(' '));
      updateConsole();
    };

    function updateConsole() {
      const output = document.getElementById('consoleOutput');
      output.textContent = logs.slice(-20).join('\n');
      output.scrollTop = output.scrollHeight;
    }

    function clearConsole() {
      logs.length = 0;
      updateConsole();
    }

    // Debug functions
    function checkSession() {
      console.log('ğŸ” Checking session...');
      
      const session = localStorage.getItem('etax_admin_session');
      if (!session) {
        console.error('âŒ No session found');
        updateDebugInfo('âŒ Session not found', 'error');
        return false;
      }

      try {
        const sessionData = JSON.parse(session);
        console.log('âœ… Session found:', sessionData);
        
        if (Date.now() > sessionData.expiresAt) {
          console.error('â° Session expired');
          updateDebugInfo('â° Session expired', 'error');
          return false;
        }
        
        updateDebugInfo('âœ… Session valid', 'success');
        return true;
      } catch (error) {
        console.error('âŒ Session parse error:', error);
        updateDebugInfo('âŒ Session parse error', 'error');
        return false;
      }
    }

    function checkFirebase() {
      console.log('ğŸ”¥ Checking Firebase...');
      
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
        console.log('âœ… Firebase initialized');
        updateDebugInfo('âœ… Firebase connected', 'success');
        
        // Test Firebase read
        db.ref('users').limitToFirst(1).once('value')
          .then(snapshot => {
            console.log('âœ… Firebase read test successful');
            updateDebugInfo('âœ… Firebase read/write OK', 'success');
          })
          .catch(error => {
            console.error('âŒ Firebase read test failed:', error);
            updateDebugInfo('âŒ Firebase read failed: ' + error.message, 'error');
          });
        
      } catch (error) {
        console.error('âŒ Firebase init failed:', error);
        updateDebugInfo('âŒ Firebase failed: ' + error.message, 'error');
      }
    }

    function checkFunctions() {
      console.log('ğŸ§ª Checking functions...');
      
      const functions = [
        'debugShowDashboard',
        'debugShowNotifications', 
        'debugShowUsers',
        'debugShowContent',
        'debugVisualEditor'
      ];
      
      functions.forEach(funcName => {
        if (typeof window[funcName] === 'function') {
          console.log(`âœ… Function ${funcName} exists`);
        } else {
          console.error(`âŒ Function ${funcName} missing`);
        }
      });
      
      updateDebugInfo('âœ… Function check completed', 'success');
    }

    function updateDebugInfo(message, type = 'info') {
      const debugInfo = document.getElementById('debugInfo');
      const className = type === 'error' ? 'error-panel' : type === 'success' ? 'success-panel' : 'debug-panel';
      
      debugInfo.className = className;
      debugInfo.innerHTML = `
        <h4>ğŸ” Debug Information</h4>
        <p><strong>Status:</strong> ${message}</p>
        <p><strong>Time:</strong> ${new Date().toLocaleTimeString()}</p>
        <p><strong>URL:</strong> ${window.location.href}</p>
      `;
    }

    // Menu functions (simplified working versions)
    function debugShowDashboard() {
      console.log('ğŸ“Š Loading Dashboard...');
      
      setActiveMenu(event.target);
      
      document.getElementById('contentArea').innerHTML = `
        <h2>ğŸ“Š DASHBOARD DEBUG</h2>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
          <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; text-align: center;">
            <h3 id="totalUsers">Loading...</h3>
            <p>Total Users</p>
          </div>
          <div style="background: #fff3e0; padding: 20px; border-radius: 10px; text-align: center;">
            <h3 id="pendingUsers">Loading...</h3>
            <p>Pending Users</p>
          </div>
          <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; text-align: center;">
            <h3 id="systemNotifications">Loading...</h3>
            <p>Notifications</p>
          </div>
        </div>
        <button onclick="loadDashboardData()">ğŸ”„ Load Real Data</button>
      `;
      
      console.log('âœ… Dashboard UI loaded');
    }

    function debugShowNotifications() {
      console.log('ğŸ“¢ Loading Notifications...');
      
      setActiveMenu(event.target);
      
      document.getElementById('contentArea').innerHTML = `
        <h2>ğŸ“¢ NOTIFICATIONS DEBUG</h2>
        <p>âœ… Notifications function working!</p>
        <button onclick="alert('Create notification functionality will be here')">â• Create Notification</button>
      `;
      
      console.log('âœ… Notifications UI loaded');
    }

    function debugShowUsers() {
      console.log('ğŸ‘¥ Loading Users...');
      
      setActiveMenu(event.target);
      
      document.getElementById('contentArea').innerHTML = `
        <h2>ğŸ‘¥ USERS DEBUG</h2>
        <p>âœ… Users function working!</p>
        <button onclick="alert('User management functionality will be here')">ğŸ‘¥ Manage Users</button>
      `;
      
      console.log('âœ… Users UI loaded');
    }

    function debugShowContent() {
      console.log('ğŸ“„ Loading Content...');
      
      setActiveMenu(event.target);
      
      document.getElementById('contentArea').innerHTML = `
        <h2>ğŸ“„ CONTENT DEBUG</h2>
        <p>âœ… Content function working!</p>
        <button onclick="alert('Content management functionality will be here')">ğŸ“ Manage Content</button>
      `;
      
      console.log('âœ… Content UI loaded');
    }

    function debugVisualEditor() {
      console.log('ğŸ¨ Opening Visual Editor...');
      
      setActiveMenu(event.target);
      
      try {
        window.open('multi-page-visual-editor.html', '_blank', 'width=1400,height=900');
        console.log('âœ… Visual Editor opened successfully');
        
        document.getElementById('contentArea').innerHTML = `
          <h2>ğŸ¨ VISUAL EDITOR DEBUG</h2>
          <p>âœ… Visual Editor opened in new tab!</p>
          <button onclick="debugVisualEditor()">ğŸ¨ Open Again</button>
        `;
        
      } catch (error) {
        console.error('âŒ Visual Editor failed:', error);
        updateDebugInfo('âŒ Visual Editor failed: ' + error.message, 'error');
      }
    }

    async function loadDashboardData() {
      console.log('ğŸ“Š Loading real dashboard data...');
      
      try {
        if (!db) {
          throw new Error('Firebase not initialized');
        }
        
        // Load users
        const usersSnapshot = await db.ref('users').once('value');
        const users = usersSnapshot.val() || {};
        const totalUsers = Object.keys(users).length;
        
        // Load requests  
        const requestsSnapshot = await db.ref('userRequests').once('value');
        const requests = requestsSnapshot.val() || {};
        const pendingUsers = Object.values(requests).filter(req => req.status === 'pending').length;
        
        // Load notifications
        const notificationsSnapshot = await db.ref('systemNotifications').once('value');
        const notifications = notificationsSnapshot.val() || {};
        const totalNotifications = Object.keys(notifications).length;
        
        // Update UI
        document.getElementById('totalUsers').textContent = totalUsers;
        document.getElementById('pendingUsers').textContent = pendingUsers;
        document.getElementById('systemNotifications').textContent = totalNotifications;
        
        console.log(`âœ… Data loaded: ${totalUsers} users, ${pendingUsers} pending, ${totalNotifications} notifications`);
        updateDebugInfo('âœ… Dashboard data loaded successfully', 'success');
        
      } catch (error) {
        console.error('âŒ Dashboard data load failed:', error);
        updateDebugInfo('âŒ Data load failed: ' + error.message, 'error');
      }
    }

    function setActiveMenu(target) {
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      target.classList.add('active');
    }

    // Initialize
    window.onload = function() {
      console.log('ğŸ›¡ï¸ Admin Panel Debug Mode loaded');
      console.log('Browser:', navigator.userAgent);
      console.log('URL:', window.location.href);
      
      updateDebugInfo('ğŸ›¡ï¸ Debug mode initialized', 'info');
      
      // Auto-check everything
      setTimeout(() => {
        checkSession();
        checkFirebase();
        checkFunctions();
      }, 1000);
    };
  </script>
</body>
</html>