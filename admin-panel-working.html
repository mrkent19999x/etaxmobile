<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ›¡ï¸ Báº¢NG ÄIá»€U KHIá»‚N eTAX ADMIN</title>
  
  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Tahoma', 'Microsoft Sans Serif', 'Arial', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .admin-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .admin-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      color: #dc3545;
    }

    .admin-user {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 14px;
      color: #666;
    }

    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s;
    }

    .logout-btn:hover {
      background: #c82333;
    }

    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px 20px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 30px;
    }

    .admin-sidebar {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .sidebar-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
      text-align: center;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px;
      margin-bottom: 8px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      color: #666;
      font-weight: 500;
    }

    .menu-item:hover, .menu-item.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateX(5px);
    }

    .menu-icon {
      font-size: 18px;
      width: 24px;
    }

    .admin-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      min-height: 600px;
    }

    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f0f0f0;
    }

    .content-title {
      font-size: 28px;
      font-weight: 700;
      color: #333;
    }

    .add-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .add-btn:hover {
      background: #218838;
      transform: translateY(-2px);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
      text-align: center;
    }

    .stat-number {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    @media (max-width: 768px) {
      .admin-container {
        grid-template-columns: 1fr;
        gap: 20px;
        padding: 20px 15px;
      }
      
      .admin-header {
        padding: 15px 20px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="admin-header">
    <div class="admin-logo">
      ğŸ›¡ï¸ eTax Admin Panel
    </div>
    
    <div class="admin-user">
      <span id="currentTime">Loading...</span>
      <span>â€¢</span>
      <span>admin@etax.vn</span>
      <button class="logout-btn" onclick="adminLogout()">ÄÄƒng xuáº¥t</button>
    </div>
  </div>

  <!-- Main Container -->
  <div class="admin-container">
    <!-- Sidebar -->
    <div class="admin-sidebar">
      <div class="sidebar-title">ğŸ›ï¸ MENU ÄIá»€U KHIá»‚N</div>
      
      <div class="menu-item active" onclick="showDashboard()">
        <div class="menu-icon">ğŸ“Š</div>
        Tá»•ng quan há»‡ thá»‘ng
      </div>
      
      <div class="menu-item" onclick="showSystemNotifications()">
        <div class="menu-icon">ğŸ“¢</div>
        ThÃ´ng bÃ¡o toÃ n há»‡ thá»‘ng
      </div>
      
      <div class="menu-item" onclick="showUserManagement()">
        <div class="menu-icon">ğŸ‘¥</div>
        Quáº£n lÃ½ ngÆ°á»i dÃ¹ng
      </div>
      
      <div class="menu-item" onclick="showContentManagement()">
        <div class="menu-icon">ğŸ“„</div>
        Quáº£n lÃ½ ná»™i dung
      </div>
      
      <div class="menu-item" onclick="openVisualEditor()">
        <div class="menu-icon">ğŸ¨</div>
        Visual Editor
      </div>
      
      <div class="menu-item" onclick="showPageManagement()">
        <div class="menu-icon">ğŸ“±</div>
        Quáº£n lÃ½ trang con
      </div>
      
      <div class="menu-item" onclick="showSystemLogs()">
        <div class="menu-icon">ğŸ“‹</div>
        Nháº­t kÃ½ há»‡ thá»‘ng
      </div>
      
      <div class="menu-item" onclick="showSettings()">
        <div class="menu-icon">âš™ï¸</div>
        CÃ i Ä‘áº·t há»‡ thá»‘ng
      </div>
    </div>

    <!-- Content -->
    <div class="admin-content">
      <div id="contentArea">
        <!-- Content will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD_rJgBFgBulheVenQUE2KXr4PBpSpTCxw",
      authDomain: "etax-7fbf8.firebaseapp.com",
      databaseURL: "https://etax-7fbf8-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "etax-7fbf8",
      storageBucket: "etax-7fbf8.appspot.com",
      messagingSenderId: "1030026724634",
      appId: "1:1030026724634:web:d76f5f9dad43bad6fd58a3",
      measurementId: "G-YS5DLECJE6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Helper functions
    function setActiveMenu(clickedItem) {
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      if (clickedItem) {
        clickedItem.classList.add('active');
      }
    }

    function updateTime() {
      const now = new Date();
      document.getElementById('currentTime').textContent = now.toLocaleTimeString('vi-VN');
    }

    // Menu functions
    function showDashboard() {
      console.log('ğŸ“Š Loading Dashboard...');
      
      setActiveMenu(document.querySelector('[onclick="showDashboard()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">ğŸ“Š Tá»”NG QUAN Há»† THá»NG</h2>
          <span style="color: #666;">Cáº­p nháº­t: ${new Date().toLocaleString('vi-VN')}</span>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalUsers">Loading...</div>
            <div class="stat-label">ğŸ‘¥ Tá»•ng ngÆ°á»i dÃ¹ng</div>
          </div>
          
          <div class="stat-card" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);">
            <div class="stat-number" id="pendingUsers">Loading...</div>
            <div class="stat-label">â³ Chá» duyá»‡t</div>
          </div>
          
          <div class="stat-card" style="background: linear-gradient(135deg, #a8e6cf 0%, #00b894 100%);">
            <div class="stat-number" id="systemNotifications">Loading...</div>
            <div class="stat-label">ğŸ“¢ ThÃ´ng bÃ¡o há»‡ thá»‘ng</div>
          </div>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
          <h4>ğŸ“ˆ Hoáº¡t Ä‘á»™ng gáº§n Ä‘Ã¢y</h4>
          <div id="recentActivity">
            <p>Äang táº£i dá»¯ liá»‡u...</p>
          </div>
        </div>
      `;
      
      loadDashboardData();
    }

    function showSystemNotifications() {
      console.log('ğŸ“¢ Loading Notifications...');
      
      setActiveMenu(document.querySelector('[onclick="showSystemNotifications()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">ğŸ“¢ THÃ”NG BÃO TOÃ€N Há»† THá»NG</h2>
          <button class="add-btn" onclick="createSystemNotification()">
            â• Táº¡o thÃ´ng bÃ¡o má»›i
          </button>
        </div>
        
        <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
          <h4>ğŸ“¢ Táº¡o thÃ´ng bÃ¡o há»‡ thá»‘ng</h4>
          <p>ThÃ´ng bÃ¡o sáº½ hiá»ƒn thá»‹ trÃªn táº¥t cáº£ trang cá»§a há»‡ thá»‘ng eTax vá»›i kháº£ nÄƒng backdate.</p>
        </div>
        
        <div id="notificationsList" style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
          <h4>ğŸ“‹ Danh sÃ¡ch thÃ´ng bÃ¡o</h4>
          <div id="notificationsContent">Äang táº£i...</div>
        </div>
      `;
      
      loadSystemNotifications();
    }

    function createSystemNotification() {
      const title = prompt('ğŸ“¢ Nháº­p tiÃªu Ä‘á» thÃ´ng bÃ¡o:');
      if (!title) return;
      
      const content = prompt('ğŸ“ Nháº­p ná»™i dung thÃ´ng bÃ¡o:');
      if (!content) return;
      
      const dateInput = prompt('ğŸ“… Nháº­p ngÃ y hiá»ƒn thá»‹ (dd/mm/yyyy) hoáº·c Ä‘á»ƒ trá»‘ng cho hÃ´m nay:');
      
      let publishDate = new Date();
      if (dateInput) {
        const parts = dateInput.split('/');
        if (parts.length === 3) {
          publishDate = new Date(parts[2], parts[1] - 1, parts[0]);
        }
      }
      
      const notificationData = {
        title: title,
        content: content,
        type: 'system',
        publishDate: publishDate.getTime(),
        createdAt: Date.now(),
        createdBy: 'admin@etax.vn',
        status: 'active'
      };
      
      db.ref('systemNotifications').push(notificationData)
        .then(() => {
          alert('âœ… ThÃ´ng bÃ¡o Ä‘Ã£ Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng!');
          loadSystemNotifications();
        })
        .catch(error => {
          alert('âŒ Lá»—i táº¡o thÃ´ng bÃ¡o: ' + error.message);
        });
    }

    async function loadSystemNotifications() {
      try {
        const snapshot = await db.ref('systemNotifications').once('value');
        const notifications = snapshot.val() || {};
        
        const notificationsArray = Object.entries(notifications).map(([id, data]) => ({
          id,
          ...data
        })).sort((a, b) => b.createdAt - a.createdAt);
        
        const content = notificationsArray.length > 0 
          ? notificationsArray.map(notif => `
              <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #007bff;">
                <h5 style="color: #333; margin-bottom: 8px;">${notif.title}</h5>
                <p style="color: #666; margin-bottom: 8px;">${notif.content}</p>
                <small style="color: #999;">
                  ğŸ“… ${new Date(notif.publishDate).toLocaleDateString('vi-VN')} â€¢ 
                  ğŸ‘¤ ${notif.createdBy}
                </small>
              </div>
            `).join('')
          : '<p style="text-align: center; color: #999;">ChÆ°a cÃ³ thÃ´ng bÃ¡o nÃ o</p>';
        
        document.getElementById('notificationsContent').innerHTML = content;
        
      } catch (error) {
        console.error('Load notifications failed:', error);
        document.getElementById('notificationsContent').innerHTML = 
          '<p style="color: #dc3545;">âŒ Lá»—i táº£i thÃ´ng bÃ¡o</p>';
      }
    }

    function showUserManagement() {
      console.log('ğŸ‘¥ Loading Users...');
      
      setActiveMenu(document.querySelector('[onclick="showUserManagement()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">ğŸ‘¥ QUáº¢N LÃ NGÆ¯á»œI DÃ™NG & OTP</h2>
          <button class="add-btn" onclick="refreshUserData()">
            ğŸ”„ Refresh Data
          </button>
        </div>
        
        <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
          <h4 style="color: #1976d2; margin-bottom: 10px;">ğŸ” SYSTEM OTP:</h4>
          <p style="color: #333; margin-bottom: 8px;">â€¢ <strong>Láº§n Ä‘áº§u:</strong> User nháº­p MST + Password â†’ Admin duyá»‡t + gá»­i OTP</p>
          <p style="color: #333; margin-bottom: 8px;">â€¢ <strong>Láº§n sau:</strong> User vÃ o luÃ´n khÃ´ng cáº§n OTP</p>
          <p style="color: #333;">â€¢ <strong>Admin control:</strong> CÃ³ thá»ƒ yÃªu cáº§u OTP láº¡i báº¥t ká»³ lÃºc nÃ o</p>
        </div>

        <div class="tabs-container" style="margin-bottom: 20px;">
          <div class="tabs" style="display: flex; background: #f8f9fa; border-radius: 10px; padding: 5px;">
            <button class="tab-btn active" onclick="showUserTab('approved')" style="flex: 1; padding: 10px; border: none; background: white; border-radius: 6px; font-weight: 600; cursor: pointer;">
              âœ… User Ä‘Ã£ duyá»‡t (<span id="approvedCount">0</span>)
            </button>
            <button class="tab-btn" onclick="showUserTab('pending')" style="flex: 1; padding: 10px; border: none; background: transparent; border-radius: 6px; font-weight: 600; cursor: pointer;">
              â³ Chá» duyá»‡t (<span id="pendingCount">0</span>)
            </button>
            <button class="tab-btn" onclick="showUserTab('blocked')" style="flex: 1; padding: 10px; border: none; background: transparent; border-radius: 6px; font-weight: 600; cursor: pointer;">
              ğŸš« ÄÃ£ khÃ³a (<span id="blockedCount">0</span>)
            </button>
          </div>
        </div>

        <div id="userTabContent"></div>
      `;
      
      loadUserManagement();
    }

    function refreshUserData() {
      loadUserManagement();
      alert('ğŸ”„ Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c refresh!');
    }

    async function loadUserManagement() {
      try {
        // Load users
        const usersSnapshot = await db.ref('users').once('value');
        const users = usersSnapshot.val() || {};
        
        // Load pending requests
        const requestsSnapshot = await db.ref('userRequests').once('value');
        const requests = requestsSnapshot.val() || {};
        
        // Count by status
        const approvedUsers = Object.values(users).filter(user => user.status === 'active');
        const pendingRequests = Object.values(requests).filter(req => req.status === 'pending');
        const blockedUsers = Object.values(users).filter(user => user.status === 'blocked');
        
        // Update counts
        document.getElementById('approvedCount').textContent = approvedUsers.length;
        document.getElementById('pendingCount').textContent = pendingRequests.length;
        document.getElementById('blockedCount').textContent = blockedUsers.length;
        
        // Show approved users by default
        showUserTab('approved');
        
      } catch (error) {
        console.error('Load user management failed:', error);
      }
    }

    async function showUserTab(tabType) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.style.background = 'transparent';
        btn.style.color = '#666';
      });
      
      event.target.style.background = 'white';
      event.target.style.color = '#333';
      
      const contentArea = document.getElementById('userTabContent');
      contentArea.innerHTML = '<p>Äang táº£i...</p>';
      
      try {
        if (tabType === 'approved') {
          const snapshot = await db.ref('users').once('value');
          const users = snapshot.val() || {};
          const approvedUsers = Object.entries(users)
            .filter(([id, user]) => user.status === 'active')
            .map(([id, user]) => ({ id, ...user }));
          
          contentArea.innerHTML = approvedUsers.length > 0 
            ? approvedUsers.map(user => `
                <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #28a745;">
                  <h5>ğŸ‘¤ MST: ${user.mst}</h5>
                  <p>ğŸ“… Táº¡o: ${new Date(user.createdAt).toLocaleDateString('vi-VN')}</p>
                  <p>ğŸ• Login cuá»‘i: ${new Date(user.lastLogin).toLocaleDateString('vi-VN')}</p>
                  <button onclick="blockUser('${user.id}')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-top: 8px;">
                    ğŸš« KhÃ³a user
                  </button>
                </div>
              `).join('')
            : '<p style="text-align: center; color: #999;">ChÆ°a cÃ³ user nÃ o Ä‘Æ°á»£c duyá»‡t</p>';
            
        } else if (tabType === 'pending') {
          const snapshot = await db.ref('userRequests').once('value');
          const requests = snapshot.val() || {};
          const pendingRequests = Object.entries(requests)
            .filter(([id, req]) => req.status === 'pending')
            .map(([id, req]) => ({ id, ...req }));
          
          contentArea.innerHTML = pendingRequests.length > 0 
            ? pendingRequests.map(req => `
                <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #ffc107;">
                  <h5>ğŸ‘¤ MST: ${req.mst}</h5>
                  <p>ğŸ“… YÃªu cáº§u: ${new Date(req.requestTime).toLocaleString('vi-VN')}</p>
                  <div style="margin-top: 10px;">
                    <button onclick="approveUser('${req.id}', '${req.mst}', '${req.password}')" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                      âœ… Duyá»‡t
                    </button>
                    <button onclick="rejectUser('${req.id}')" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                      âŒ Tá»« chá»‘i
                    </button>
                  </div>
                </div>
              `).join('')
            : '<p style="text-align: center; color: #999;">KhÃ´ng cÃ³ yÃªu cáº§u nÃ o Ä‘ang chá»</p>';
            
        } else if (tabType === 'blocked') {
          const snapshot = await db.ref('users').once('value');
          const users = snapshot.val() || {};
          const blockedUsers = Object.entries(users)
            .filter(([id, user]) => user.status === 'blocked')
            .map(([id, user]) => ({ id, ...user }));
          
          contentArea.innerHTML = blockedUsers.length > 0 
            ? blockedUsers.map(user => `
                <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #dc3545;">
                  <h5>ğŸ‘¤ MST: ${user.mst}</h5>
                  <p>ğŸ“… Bá»‹ khÃ³a: ${new Date(user.blockedAt || user.createdAt).toLocaleDateString('vi-VN')}</p>
                  <button onclick="unblockUser('${user.id}')" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-top: 8px;">
                    âœ… Má»Ÿ khÃ³a
                  </button>
                </div>
              `).join('')
            : '<p style="text-align: center; color: #999;">KhÃ´ng cÃ³ user nÃ o bá»‹ khÃ³a</p>';
        }
        
      } catch (error) {
        console.error('Show user tab failed:', error);
        contentArea.innerHTML = '<p style="color: #dc3545;">âŒ Lá»—i táº£i dá»¯ liá»‡u</p>';
      }
    }

    async function approveUser(requestId, mst, password) {
      try {
        const otp = Math.floor(100000 + Math.random() * 900000).toString();
        
        // Create user
        await db.ref('users/' + mst).set({
          mst: mst,
          password: password,
          status: 'active',
          createdAt: Date.now(),
          lastLogin: Date.now()
        });
        
        // Update request with OTP
        await db.ref('userRequests/' + requestId).update({
          status: 'approved',
          otp: otp,
          approvedTime: Date.now(),
          approvedBy: 'admin@etax.vn'
        });
        
        alert(`âœ… User Ä‘Æ°á»£c duyá»‡t thÃ nh cÃ´ng!\nOTP: ${otp}\n(OTP Ä‘Ã£ Ä‘Æ°á»£c gá»­i cho user)`);
        loadUserManagement();
        
      } catch (error) {
        alert('âŒ Lá»—i duyá»‡t user: ' + error.message);
      }
    }

    async function rejectUser(requestId) {
      if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n tá»« chá»‘i yÃªu cáº§u nÃ y?')) return;
      
      try {
        await db.ref('userRequests/' + requestId).update({
          status: 'rejected',
          rejectedTime: Date.now(),
          rejectedBy: 'admin@etax.vn'
        });
        
        alert('âŒ YÃªu cáº§u Ä‘Ã£ Ä‘Æ°á»£c tá»« chá»‘i');
        loadUserManagement();
        
      } catch (error) {
        alert('âŒ Lá»—i tá»« chá»‘i user: ' + error.message);
      }
    }

    async function blockUser(userId) {
      if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n khÃ³a user nÃ y?')) return;
      
      try {
        await db.ref('users/' + userId).update({
          status: 'blocked',
          blockedAt: Date.now(),
          blockedBy: 'admin@etax.vn'
        });
        
        alert('ğŸš« User Ä‘Ã£ Ä‘Æ°á»£c khÃ³a');
        loadUserManagement();
        
      } catch (error) {
        alert('âŒ Lá»—i khÃ³a user: ' + error.message);
      }
    }

    async function unblockUser(userId) {
      if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n má»Ÿ khÃ³a user nÃ y?')) return;
      
      try {
        await db.ref('users/' + userId).update({
          status: 'active',
          unblockedAt: Date.now(),
          unblockedBy: 'admin@etax.vn'
        });
        
        alert('âœ… User Ä‘Ã£ Ä‘Æ°á»£c má»Ÿ khÃ³a');
        loadUserManagement();
        
      } catch (error) {
        alert('âŒ Lá»—i má»Ÿ khÃ³a user: ' + error.message);
      }
    }

    function showContentManagement() {
      console.log('ğŸ“„ Loading Content...');
      
      setActiveMenu(document.querySelector('[onclick="showContentManagement()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">ğŸ“„ QUáº¢N LÃ Ná»˜I DUNG</h2>
          <button class="add-btn" onclick="alert('Rich Text Editor sáº½ Ä‘Æ°á»£c tÃ­ch há»£p')">
            ğŸ“ Táº¡o ná»™i dung má»›i
          </button>
        </div>
        
        <div style="background: #f3e5f5; padding: 20px; border-radius: 10px;">
          <h4>ğŸ“ Content Management</h4>
          <p>Quáº£n lÃ½ ná»™i dung vÃ  rich text editor cho há»‡ thá»‘ng.</p>
        </div>
      `;
    }

    function openVisualEditor() {
      console.log('ğŸ¨ Opening Visual Editor...');
      
      setActiveMenu(document.querySelector('[onclick="openVisualEditor()"]'));
      
      try {
        window.open('multi-page-visual-editor.html', '_blank', 'width=1400,height=900');
        
        document.getElementById('contentArea').innerHTML = `
          <div class="content-header">
            <h2 class="content-title">ğŸ¨ VISUAL EDITOR</h2>
            <button class="add-btn" onclick="openVisualEditor()">
              ğŸ¨ Má»Ÿ láº¡i Visual Editor
            </button>
          </div>
          
          <div style="background: #e8f4fd; padding: 30px; border-radius: 15px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ¨</div>
            <h3 style="color: #333; margin-bottom: 15px;">Visual Editor Ä‘Ã£ má»Ÿ trong tab má»›i!</h3>
            <p style="color: #666;">
              CÃ´ng cá»¥ chá»‰nh sá»­a visual cho phÃ©p chá»‰nh sá»­a styling cho táº¥t cáº£ trang eTax.
            </p>
          </div>
        `;
        
        console.log('âœ… Visual Editor opened successfully');
        
      } catch (error) {
        console.error('âŒ Visual Editor failed:', error);
        alert('âŒ KhÃ´ng thá»ƒ má»Ÿ Visual Editor: ' + error.message);
      }
    }

    function showPageManagement() {
      console.log('ğŸ“± Loading Page Management...');
      
      setActiveMenu(document.querySelector('[onclick="showPageManagement()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">ğŸ“± QUáº¢N LÃ TRANG CON</h2>
          <button class="add-btn" onclick="alert('TÃ­nh nÄƒng sáº½ Ä‘Æ°á»£c phÃ¡t triá»ƒn')">
            â• ThÃªm trang má»›i
          </button>
        </div>
        
        <div style="background: #e8f5e8; padding: 20px; border-radius: 10px;">
          <h3>ğŸš§ Chá»©c nÄƒng Ä‘ang phÃ¡t triá»ƒn</h3>
          <p>Quáº£n lÃ½ cÃ¡c trang con sáº½ Ä‘Æ°á»£c bá»• sung trong phiÃªn báº£n tiáº¿p theo</p>
        </div>
      `;
    }

    function showSystemLogs() {
      console.log('ğŸ“‹ Loading System Logs...');
      
      setActiveMenu(document.querySelector('[onclick="showSystemLogs()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">ğŸ“‹ NHáº¬T KÃ Há»† THá»NG</h2>
          <button class="add-btn" onclick="alert('TÃ­nh nÄƒng export logs sáº½ Ä‘Æ°á»£c bá»• sung')">
            ğŸ“¥ Export logs
          </button>
        </div>
        
        <div style="background: #fff3cd; padding: 20px; border-radius: 10px;">
          <h3>ğŸ“‹ System Logs</h3>
          <p>Chá»©c nÄƒng theo dÃµi nháº­t kÃ½ há»‡ thá»‘ng sáº½ Ä‘Æ°á»£c phÃ¡t triá»ƒn</p>
        </div>
      `;
    }

    function showSettings() {
      console.log('âš™ï¸ Loading Settings...');
      
      setActiveMenu(document.querySelector('[onclick="showSettings()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">âš™ï¸ CÃ€I Äáº¶T Há»† THá»NG</h2>
          <button class="add-btn" onclick="alert('TÃ­nh nÄƒng backup sáº½ Ä‘Æ°á»£c bá»• sung')">
            ğŸ’¾ Backup System
          </button>
        </div>
        
        <div style="background: #f8d7da; padding: 20px; border-radius: 10px;">
          <h3>âš™ï¸ System Settings</h3>
          <p>CÃ i Ä‘áº·t há»‡ thá»‘ng sáº½ Ä‘Æ°á»£c phÃ¡t triá»ƒn trong phiÃªn báº£n tiáº¿p theo</p>
        </div>
      `;
    }

    function adminLogout() {
      if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n Ä‘Äƒng xuáº¥t?')) {
        localStorage.removeItem('etax_admin_session');
        window.location.href = 'admin-login.html';
      }
    }

    async function loadDashboardData() {
      try {
        console.log('ğŸ“Š Loading real dashboard data...');
        
        // Load users
        const usersSnapshot = await db.ref('users').once('value');
        const users = usersSnapshot.val() || {};
        const totalUsers = Object.keys(users).length;
        
        // Load requests  
        const requestsSnapshot = await db.ref('userRequests').once('value');
        const requests = requestsSnapshot.val() || {};
        const pendingUsers = Object.values(requests).filter(req => req.status === 'pending').length;
        
        // Load notifications
        const notificationsSnapshot = await db.ref('systemNotifications').once('value');
        const notifications = notificationsSnapshot.val() || {};
        const totalNotifications = Object.keys(notifications).length;
        
        // Update UI
        document.getElementById('totalUsers').textContent = totalUsers;
        document.getElementById('pendingUsers').textContent = pendingUsers;
        document.getElementById('systemNotifications').textContent = totalNotifications;
        
        document.getElementById('recentActivity').innerHTML = `
          <p>âœ… Dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c táº£i thÃ nh cÃ´ng</p>
          <p>ğŸ“Š ${totalUsers} users, ${pendingUsers} pending, ${totalNotifications} notifications</p>
        `;
        
        console.log(`âœ… Data loaded: ${totalUsers} users, ${pendingUsers} pending, ${totalNotifications} notifications`);
        
      } catch (error) {
        console.error('âŒ Dashboard data load failed:', error);
        document.getElementById('totalUsers').textContent = 'Error';
        document.getElementById('pendingUsers').textContent = 'Error';
        document.getElementById('systemNotifications').textContent = 'Error';
      }
    }

    // Check admin session
    function checkAdminSession() {
      const session = localStorage.getItem('etax_admin_session');
      if (!session) {
        alert('âŒ Báº¡n chÆ°a Ä‘Äƒng nháº­p! Chuyá»ƒn vá» trang Ä‘Äƒng nháº­p...');
        window.location.href = 'admin-login.html';
        return false;
      }

      try {
        const sessionData = JSON.parse(session);
        if (Date.now() > sessionData.expiresAt) {
          alert('â° PhiÃªn lÃ m viá»‡c Ä‘Ã£ háº¿t háº¡n! Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i...');
          localStorage.removeItem('etax_admin_session');
          window.location.href = 'admin-login.html';
          return false;
        }
        return true;
      } catch (error) {
        console.error('Session error:', error);
        localStorage.removeItem('etax_admin_session');
        window.location.href = 'admin-login.html';
        return false;
      }
    }

    // Initialize
    window.onload = function() {
      console.log('ğŸ›¡ï¸ Admin Panel loading...');
      
      if (!checkAdminSession()) return;
      
      updateTime();
      setInterval(updateTime, 1000);
      showDashboard();
      
      console.log('âœ… Admin Panel loaded successfully');
    };
  </script>
</body>
</html>