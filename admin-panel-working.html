<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üõ°Ô∏è B·∫¢NG ƒêI·ªÄU KHI·ªÇN eTAX ADMIN</title>
  
  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Tahoma', 'Microsoft Sans Serif', 'Arial', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .admin-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .admin-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      color: #dc3545;
    }

    .admin-user {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 14px;
      color: #666;
    }

    .logout-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s;
    }

    .logout-btn:hover {
      background: #c82333;
    }

    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px 20px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 30px;
    }

    .admin-sidebar {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .sidebar-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
      text-align: center;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px;
      margin-bottom: 8px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      color: #666;
      font-weight: 500;
    }

    .menu-item:hover, .menu-item.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateX(5px);
    }

    .menu-icon {
      font-size: 18px;
      width: 24px;
    }

    .admin-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      min-height: 600px;
    }

    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f0f0f0;
    }

    .content-title {
      font-size: 28px;
      font-weight: 700;
      color: #333;
    }

    .add-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .add-btn:hover {
      background: #218838;
      transform: translateY(-2px);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
      text-align: center;
    }

    .stat-number {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    @media (max-width: 768px) {
      .admin-container {
        grid-template-columns: 1fr;
        gap: 20px;
        padding: 20px 15px;
      }
      
      .admin-header {
        padding: 15px 20px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="admin-header">
    <div class="admin-logo">
      üõ°Ô∏è eTax Admin Panel
    </div>
    
    <div class="admin-user">
      <span id="currentTime">Loading...</span>
      <span>‚Ä¢</span>
      <span>admin@etax.vn</span>
      <button class="logout-btn" onclick="adminLogout()">ƒêƒÉng xu·∫•t</button>
    </div>
  </div>

  <!-- Main Container -->
  <div class="admin-container">
    <!-- Sidebar -->
    <div class="admin-sidebar">
      <div class="sidebar-title">üéõÔ∏è MENU ƒêI·ªÄU KHI·ªÇN</div>
      
      <div class="menu-item active" onclick="showDashboard()">
        <div class="menu-icon">üìä</div>
        T·ªïng quan h·ªá th·ªëng
      </div>
      
      <div class="menu-item" onclick="showSystemNotifications()">
        <div class="menu-icon">üì¢</div>
        Th√¥ng b√°o to√†n h·ªá th·ªëng
      </div>
      
      <div class="menu-item" onclick="showUserManagement()">
        <div class="menu-icon">üë•</div>
        Qu·∫£n l√Ω ng∆∞·ªùi d√πng
      </div>
      
      <div class="menu-item" onclick="showContentManagement()">
        <div class="menu-icon">üìÑ</div>
        Qu·∫£n l√Ω n·ªôi dung
      </div>
      
      <div class="menu-item" onclick="openVisualEditor()">
        <div class="menu-icon">üé®</div>
        Visual Editor
      </div>
      
      <div class="menu-item" onclick="showPageManagement()">
        <div class="menu-icon">üì±</div>
        Qu·∫£n l√Ω trang con
      </div>
      
      <div class="menu-item" onclick="showSystemLogs()">
        <div class="menu-icon">üìã</div>
        Nh·∫≠t k√Ω h·ªá th·ªëng
      </div>
      
      <div class="menu-item" onclick="showSettings()">
        <div class="menu-icon">‚öôÔ∏è</div>
        C√†i ƒë·∫∑t h·ªá th·ªëng
      </div>
    </div>

    <!-- Content -->
    <div class="admin-content">
      <div id="contentArea">
        <!-- Content will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD_rJgBFgBulheVenQUE2KXr4PBpSpTCxw",
      authDomain: "etax-7fbf8.firebaseapp.com",
      databaseURL: "https://etax-7fbf8-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "etax-7fbf8",
      storageBucket: "etax-7fbf8.appspot.com",
      messagingSenderId: "1030026724634",
      appId: "1:1030026724634:web:d76f5f9dad43bad6fd58a3",
      measurementId: "G-YS5DLECJE6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Helper functions
    function setActiveMenu(clickedItem) {
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      if (clickedItem) {
        clickedItem.classList.add('active');
      }
    }

    function updateTime() {
      const now = new Date();
      document.getElementById('currentTime').textContent = now.toLocaleTimeString('vi-VN');
    }

    // Menu functions
    function showDashboard() {
      console.log('üìä Loading Dashboard...');
      
      setActiveMenu(document.querySelector('[onclick="showDashboard()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">üìä T·ªîNG QUAN H·ªÜ TH·ªêNG</h2>
          <span style="color: #666;">C·∫≠p nh·∫≠t: ${new Date().toLocaleString('vi-VN')}</span>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalUsers">Loading...</div>
            <div class="stat-label">üë• T·ªïng ng∆∞·ªùi d√πng</div>
          </div>
          
          <div class="stat-card" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);">
            <div class="stat-number" id="pendingUsers">Loading...</div>
            <div class="stat-label">‚è≥ Ch·ªù duy·ªát</div>
          </div>
          
          <div class="stat-card" style="background: linear-gradient(135deg, #a8e6cf 0%, #00b894 100%);">
            <div class="stat-number" id="systemNotifications">Loading...</div>
            <div class="stat-label">üì¢ Th√¥ng b√°o h·ªá th·ªëng</div>
          </div>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
          <h4>üìà Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h4>
          <div id="recentActivity">
            <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
          </div>
        </div>
      `;
      
      loadDashboardData();
    }

    function showSystemNotifications() {
      console.log('üì¢ Loading Notifications...');
      
      setActiveMenu(document.querySelector('[onclick="showSystemNotifications()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">üì¢ TH√îNG B√ÅO TO√ÄN H·ªÜ TH·ªêNG</h2>
          <button class="add-btn" onclick="createSystemNotification()">
            ‚ûï T·∫°o th√¥ng b√°o m·ªõi
          </button>
        </div>
        
        <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
          <h4>üì¢ T·∫°o th√¥ng b√°o h·ªá th·ªëng</h4>
          <p>Th√¥ng b√°o s·∫Ω hi·ªÉn th·ªã tr√™n t·∫•t c·∫£ trang c·ªßa h·ªá th·ªëng eTax v·ªõi kh·∫£ nƒÉng backdate.</p>
        </div>
        
        <div id="notificationsList" style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
          <h4>üìã Danh s√°ch th√¥ng b√°o</h4>
          <div id="notificationsContent">ƒêang t·∫£i...</div>
        </div>
      `;
      
      loadSystemNotifications();
    }

    function createSystemNotification() {
      const title = prompt('üì¢ Nh·∫≠p ti√™u ƒë·ªÅ th√¥ng b√°o:');
      if (!title) return;
      
      const content = prompt('üìù Nh·∫≠p n·ªôi dung th√¥ng b√°o:');
      if (!content) return;
      
      const dateInput = prompt('üìÖ Nh·∫≠p ng√†y hi·ªÉn th·ªã (dd/mm/yyyy) ho·∫∑c ƒë·ªÉ tr·ªëng cho h√¥m nay:');
      
      let publishDate = new Date();
      if (dateInput) {
        const parts = dateInput.split('/');
        if (parts.length === 3) {
          publishDate = new Date(parts[2], parts[1] - 1, parts[0]);
        }
      }
      
      const notificationData = {
        title: title,
        content: content,
        type: 'system',
        publishDate: publishDate.getTime(),
        createdAt: Date.now(),
        createdBy: 'admin@etax.vn',
        status: 'active'
      };
      
      db.ref('systemNotifications').push(notificationData)
        .then(() => {
          alert('‚úÖ Th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!');
          loadSystemNotifications();
        })
        .catch(error => {
          alert('‚ùå L·ªói t·∫°o th√¥ng b√°o: ' + error.message);
        });
    }

    async function loadSystemNotifications() {
      try {
        const snapshot = await db.ref('systemNotifications').once('value');
        const notifications = snapshot.val() || {};
        
        const notificationsArray = Object.entries(notifications).map(([id, data]) => ({
          id,
          ...data
        })).sort((a, b) => b.createdAt - a.createdAt);
        
        const content = notificationsArray.length > 0 
          ? notificationsArray.map(notif => `
              <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #007bff;">
                <h5 style="color: #333; margin-bottom: 8px;">${notif.title}</h5>
                <p style="color: #666; margin-bottom: 8px;">${notif.content}</p>
                <small style="color: #999;">
                  üìÖ ${new Date(notif.publishDate).toLocaleDateString('vi-VN')} ‚Ä¢ 
                  üë§ ${notif.createdBy}
                </small>
              </div>
            `).join('')
          : '<p style="text-align: center; color: #999;">Ch∆∞a c√≥ th√¥ng b√°o n√†o</p>';
        
        document.getElementById('notificationsContent').innerHTML = content;
        
      } catch (error) {
        console.error('Load notifications failed:', error);
        document.getElementById('notificationsContent').innerHTML = 
          '<p style="color: #dc3545;">‚ùå L·ªói t·∫£i th√¥ng b√°o</p>';
      }
    }

    function showUserManagement() {
      console.log('üë• Loading Users...');
      
      setActiveMenu(document.querySelector('[onclick="showUserManagement()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">üë• QU·∫¢N L√ù NG∆Ø·ªúI D√ôNG & OTP</h2>
          <button class="add-btn" onclick="refreshUserData()">
            üîÑ Refresh Data
          </button>
        </div>
        
        <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
          <h4 style="color: #1976d2; margin-bottom: 10px;">üîê SYSTEM OTP:</h4>
          <p style="color: #333; margin-bottom: 8px;">‚Ä¢ <strong>L·∫ßn ƒë·∫ßu:</strong> User nh·∫≠p MST + Password ‚Üí Admin duy·ªát + g·ª≠i OTP</p>
          <p style="color: #333; margin-bottom: 8px;">‚Ä¢ <strong>L·∫ßn sau:</strong> User v√†o lu√¥n kh√¥ng c·∫ßn OTP</p>
          <p style="color: #333;">‚Ä¢ <strong>Admin control:</strong> C√≥ th·ªÉ y√™u c·∫ßu OTP l·∫°i b·∫•t k·ª≥ l√∫c n√†o</p>
        </div>

        <div class="tabs-container" style="margin-bottom: 20px;">
          <div class="tabs" style="display: flex; background: #f8f9fa; border-radius: 10px; padding: 5px;">
            <button class="tab-btn active" onclick="showUserTab('approved')" style="flex: 1; padding: 10px; border: none; background: white; border-radius: 6px; font-weight: 600; cursor: pointer;">
              ‚úÖ User ƒë√£ duy·ªát (<span id="approvedCount">0</span>)
            </button>
            <button class="tab-btn" onclick="showUserTab('pending')" style="flex: 1; padding: 10px; border: none; background: transparent; border-radius: 6px; font-weight: 600; cursor: pointer;">
              ‚è≥ Ch·ªù duy·ªát (<span id="pendingCount">0</span>)
            </button>
            <button class="tab-btn" onclick="showUserTab('blocked')" style="flex: 1; padding: 10px; border: none; background: transparent; border-radius: 6px; font-weight: 600; cursor: pointer;">
              üö´ ƒê√£ kh√≥a (<span id="blockedCount">0</span>)
            </button>
          </div>
        </div>

        <div id="userTabContent"></div>
      `;
      
      loadUserManagement();
    }

    function refreshUserData() {
      loadUserManagement();
      alert('üîÑ D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c refresh!');
    }

    async function loadUserManagement() {
      try {
        // Load users
        const usersSnapshot = await db.ref('users').once('value');
        const users = usersSnapshot.val() || {};
        
        // Load pending requests
        const requestsSnapshot = await db.ref('userRequests').once('value');
        const requests = requestsSnapshot.val() || {};
        
        // Count by status
        const approvedUsers = Object.values(users).filter(user => user.status === 'active');
        const pendingRequests = Object.values(requests).filter(req => req.status === 'pending');
        const blockedUsers = Object.values(users).filter(user => user.status === 'blocked');
        
        // Update counts
        document.getElementById('approvedCount').textContent = approvedUsers.length;
        document.getElementById('pendingCount').textContent = pendingRequests.length;
        document.getElementById('blockedCount').textContent = blockedUsers.length;
        
        // Show approved users by default
        showUserTab('approved');
        
      } catch (error) {
        console.error('Load user management failed:', error);
      }
    }

    async function showUserTab(tabType) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.style.background = 'transparent';
        btn.style.color = '#666';
      });
      
      event.target.style.background = 'white';
      event.target.style.color = '#333';
      
      const contentArea = document.getElementById('userTabContent');
      contentArea.innerHTML = '<p>ƒêang t·∫£i...</p>';
      
      try {
        if (tabType === 'approved') {
          const snapshot = await db.ref('users').once('value');
          const users = snapshot.val() || {};
          const approvedUsers = Object.entries(users)
            .filter(([id, user]) => user.status === 'active')
            .map(([id, user]) => ({ id, ...user }));
          
          contentArea.innerHTML = approvedUsers.length > 0 
            ? approvedUsers.map(user => `
                <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #28a745;">
                  <h5>üë§ MST: ${user.mst}</h5>
                  <p>üìÖ T·∫°o: ${new Date(user.createdAt).toLocaleDateString('vi-VN')}</p>
                  <p>üïê Login cu·ªëi: ${new Date(user.lastLogin).toLocaleDateString('vi-VN')}</p>
                  <button onclick="blockUser('${user.id}')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-top: 8px;">
                    üö´ Kh√≥a user
                  </button>
                </div>
              `).join('')
            : '<p style="text-align: center; color: #999;">Ch∆∞a c√≥ user n√†o ƒë∆∞·ª£c duy·ªát</p>';
            
        } else if (tabType === 'pending') {
          const snapshot = await db.ref('userRequests').once('value');
          const requests = snapshot.val() || {};
          const pendingRequests = Object.entries(requests)
            .filter(([id, req]) => req.status === 'pending')
            .map(([id, req]) => ({ id, ...req }));
          
          contentArea.innerHTML = pendingRequests.length > 0 
            ? pendingRequests.map(req => `
                <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #ffc107;">
                  <h5>üë§ MST: ${req.mst}</h5>
                  <p>üìÖ Y√™u c·∫ßu: ${new Date(req.requestTime).toLocaleString('vi-VN')}</p>
                  <div style="margin-top: 10px;">
                    <button onclick="approveUser('${req.id}', '${req.mst}', '${req.password}')" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                      ‚úÖ Duy·ªát
                    </button>
                    <button onclick="rejectUser('${req.id}')" style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">
                      ‚ùå T·ª´ ch·ªëi
                    </button>
                  </div>
                </div>
              `).join('')
            : '<p style="text-align: center; color: #999;">Kh√¥ng c√≥ y√™u c·∫ßu n√†o ƒëang ch·ªù</p>';
            
        } else if (tabType === 'blocked') {
          const snapshot = await db.ref('users').once('value');
          const users = snapshot.val() || {};
          const blockedUsers = Object.entries(users)
            .filter(([id, user]) => user.status === 'blocked')
            .map(([id, user]) => ({ id, ...user }));
          
          contentArea.innerHTML = blockedUsers.length > 0 
            ? blockedUsers.map(user => `
                <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #dc3545;">
                  <h5>üë§ MST: ${user.mst}</h5>
                  <p>üìÖ B·ªã kh√≥a: ${new Date(user.blockedAt || user.createdAt).toLocaleDateString('vi-VN')}</p>
                  <button onclick="unblockUser('${user.id}')" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-top: 8px;">
                    ‚úÖ M·ªü kh√≥a
                  </button>
                </div>
              `).join('')
            : '<p style="text-align: center; color: #999;">Kh√¥ng c√≥ user n√†o b·ªã kh√≥a</p>';
        }
        
      } catch (error) {
        console.error('Show user tab failed:', error);
        contentArea.innerHTML = '<p style="color: #dc3545;">‚ùå L·ªói t·∫£i d·ªØ li·ªáu</p>';
      }
    }

    async function approveUser(requestId, mst, password) {
      try {
        const otp = Math.floor(100000 + Math.random() * 900000).toString();
        
        // Create user
        await db.ref('users/' + mst).set({
          mst: mst,
          password: password,
          status: 'active',
          createdAt: Date.now(),
          lastLogin: Date.now()
        });
        
        // Update request with OTP
        await db.ref('userRequests/' + requestId).update({
          status: 'approved',
          otp: otp,
          approvedTime: Date.now(),
          approvedBy: 'admin@etax.vn'
        });
        
        alert(`‚úÖ User ƒë∆∞·ª£c duy·ªát th√†nh c√¥ng!\nOTP: ${otp}\n(OTP ƒë√£ ƒë∆∞·ª£c g·ª≠i cho user)`);
        loadUserManagement();
        
      } catch (error) {
        alert('‚ùå L·ªói duy·ªát user: ' + error.message);
      }
    }

    async function rejectUser(requestId) {
      if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën t·ª´ ch·ªëi y√™u c·∫ßu n√†y?')) return;
      
      try {
        await db.ref('userRequests/' + requestId).update({
          status: 'rejected',
          rejectedTime: Date.now(),
          rejectedBy: 'admin@etax.vn'
        });
        
        alert('‚ùå Y√™u c·∫ßu ƒë√£ ƒë∆∞·ª£c t·ª´ ch·ªëi');
        loadUserManagement();
        
      } catch (error) {
        alert('‚ùå L·ªói t·ª´ ch·ªëi user: ' + error.message);
      }
    }

    async function blockUser(userId) {
      if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën kh√≥a user n√†y?')) return;
      
      try {
        await db.ref('users/' + userId).update({
          status: 'blocked',
          blockedAt: Date.now(),
          blockedBy: 'admin@etax.vn'
        });
        
        alert('üö´ User ƒë√£ ƒë∆∞·ª£c kh√≥a');
        loadUserManagement();
        
      } catch (error) {
        alert('‚ùå L·ªói kh√≥a user: ' + error.message);
      }
    }

    async function unblockUser(userId) {
      if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën m·ªü kh√≥a user n√†y?')) return;
      
      try {
        await db.ref('users/' + userId).update({
          status: 'active',
          unblockedAt: Date.now(),
          unblockedBy: 'admin@etax.vn'
        });
        
        alert('‚úÖ User ƒë√£ ƒë∆∞·ª£c m·ªü kh√≥a');
        loadUserManagement();
        
      } catch (error) {
        alert('‚ùå L·ªói m·ªü kh√≥a user: ' + error.message);
      }
    }

    function showContentManagement() {
      console.log('üìÑ Loading Content...');
      
      setActiveMenu(document.querySelector('[onclick="showContentManagement()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">üìÑ QU·∫¢N L√ù N·ªòI DUNG</h2>
          <button class="add-btn" onclick="alert('Rich Text Editor s·∫Ω ƒë∆∞·ª£c t√≠ch h·ª£p')">
            üìù T·∫°o n·ªôi dung m·ªõi
          </button>
        </div>
        
        <div style="background: #f3e5f5; padding: 20px; border-radius: 10px;">
          <h4>üìù Content Management</h4>
          <p>Qu·∫£n l√Ω n·ªôi dung v√† rich text editor cho h·ªá th·ªëng.</p>
        </div>
      `;
    }

    function openVisualEditor() {
      console.log('üé® Opening Visual Editor...');
      
      setActiveMenu(document.querySelector('[onclick="openVisualEditor()"]'));
      
      try {
        window.open('multi-page-visual-editor.html', '_blank', 'width=1400,height=900');
        
        document.getElementById('contentArea').innerHTML = `
          <div class="content-header">
            <h2 class="content-title">üé® VISUAL EDITOR</h2>
            <button class="add-btn" onclick="openVisualEditor()">
              üé® M·ªü l·∫°i Visual Editor
            </button>
          </div>
          
          <div style="background: #e8f4fd; padding: 30px; border-radius: 15px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 20px;">üé®</div>
            <h3 style="color: #333; margin-bottom: 15px;">Visual Editor ƒë√£ m·ªü trong tab m·ªõi!</h3>
            <p style="color: #666;">
              C√¥ng c·ª• ch·ªânh s·ª≠a visual cho ph√©p ch·ªânh s·ª≠a styling cho t·∫•t c·∫£ trang eTax.
            </p>
          </div>
        `;
        
        console.log('‚úÖ Visual Editor opened successfully');
        
      } catch (error) {
        console.error('‚ùå Visual Editor failed:', error);
        alert('‚ùå Kh√¥ng th·ªÉ m·ªü Visual Editor: ' + error.message);
      }
    }

    function showPageManagement() {
      console.log('üì± Loading Page Management...');
      
      setActiveMenu(document.querySelector('[onclick="showPageManagement()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">üì± QU·∫¢N L√ù TRANG CON</h2>
          <button class="add-btn" onclick="alert('T√≠nh nƒÉng s·∫Ω ƒë∆∞·ª£c ph√°t tri·ªÉn')">
            ‚ûï Th√™m trang m·ªõi
          </button>
        </div>
        
        <div style="background: #e8f5e8; padding: 20px; border-radius: 10px;">
          <h3>üöß Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn</h3>
          <p>Qu·∫£n l√Ω c√°c trang con s·∫Ω ƒë∆∞·ª£c b·ªï sung trong phi√™n b·∫£n ti·∫øp theo</p>
        </div>
      `;
    }

    function showSystemLogs() {
      console.log('üìã Loading System Logs...');
      
      setActiveMenu(document.querySelector('[onclick="showSystemLogs()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">üìã NH·∫¨T K√ù H·ªÜ TH·ªêNG</h2>
          <button class="add-btn" onclick="alert('T√≠nh nƒÉng export logs s·∫Ω ƒë∆∞·ª£c b·ªï sung')">
            üì• Export logs
          </button>
        </div>
        
        <div style="background: #fff3cd; padding: 20px; border-radius: 10px;">
          <h3>üìã System Logs</h3>
          <p>Ch·ª©c nƒÉng theo d√µi nh·∫≠t k√Ω h·ªá th·ªëng s·∫Ω ƒë∆∞·ª£c ph√°t tri·ªÉn</p>
        </div>
      `;
    }

    function showSettings() {
      console.log('‚öôÔ∏è Loading Settings...');
      
      setActiveMenu(document.querySelector('[onclick="showSettings()"]'));
      
      document.getElementById('contentArea').innerHTML = `
        <div class="content-header">
          <h2 class="content-title">‚öôÔ∏è C√ÄI ƒê·∫∂T H·ªÜ TH·ªêNG</h2>
          <button class="add-btn" onclick="alert('T√≠nh nƒÉng backup s·∫Ω ƒë∆∞·ª£c b·ªï sung')">
            üíæ Backup System
          </button>
        </div>
        
        <div style="background: #f8d7da; padding: 20px; border-radius: 10px;">
          <h3>‚öôÔ∏è System Settings</h3>
          <p>C√†i ƒë·∫∑t h·ªá th·ªëng s·∫Ω ƒë∆∞·ª£c ph√°t tri·ªÉn trong phi√™n b·∫£n ti·∫øp theo</p>
        </div>
      `;
    }

    function adminLogout() {
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
        localStorage.removeItem('etax_admin_session');
        window.location.href = 'admin-login.html';
      }
    }

    async function loadDashboardData() {
      try {
        console.log('üìä Loading real dashboard data...');
        
        // Load users
        const usersSnapshot = await db.ref('users').once('value');
        const users = usersSnapshot.val() || {};
        const totalUsers = Object.keys(users).length;
        
        // Load requests  
        const requestsSnapshot = await db.ref('userRequests').once('value');
        const requests = requestsSnapshot.val() || {};
        const pendingUsers = Object.values(requests).filter(req => req.status === 'pending').length;
        
        // Load notifications
        const notificationsSnapshot = await db.ref('systemNotifications').once('value');
        const notifications = notificationsSnapshot.val() || {};
        const totalNotifications = Object.keys(notifications).length;
        
        // Update UI
        document.getElementById('totalUsers').textContent = totalUsers;
        document.getElementById('pendingUsers').textContent = pendingUsers;
        document.getElementById('systemNotifications').textContent = totalNotifications;
        
        document.getElementById('recentActivity').innerHTML = `
          <p>‚úÖ D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c t·∫£i th√†nh c√¥ng</p>
          <p>üìä ${totalUsers} users, ${pendingUsers} pending, ${totalNotifications} notifications</p>
        `;
        
        console.log(`‚úÖ Data loaded: ${totalUsers} users, ${pendingUsers} pending, ${totalNotifications} notifications`);
        
      } catch (error) {
        console.error('‚ùå Dashboard data load failed:', error);
        document.getElementById('totalUsers').textContent = 'Error';
        document.getElementById('pendingUsers').textContent = 'Error';
        document.getElementById('systemNotifications').textContent = 'Error';
      }
    }

    // Check admin session
    function checkAdminSession() {
      const session = localStorage.getItem('etax_admin_session');
      if (!session) {
        alert('‚ùå B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p! Chuy·ªÉn v·ªÅ trang ƒëƒÉng nh·∫≠p...');
        window.location.href = 'admin-login.html';
        return false;
      }

      try {
        const sessionData = JSON.parse(session);
        if (Date.now() > sessionData.expiresAt) {
          alert('‚è∞ Phi√™n l√†m vi·ªác ƒë√£ h·∫øt h·∫°n! Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i...');
          localStorage.removeItem('etax_admin_session');
          window.location.href = 'admin-login.html';
          return false;
        }
        return true;
      } catch (error) {
        console.error('Session error:', error);
        localStorage.removeItem('etax_admin_session');
        window.location.href = 'admin-login.html';
        return false;
      }
    }

    // Initialize
    window.onload = function() {
      console.log('üõ°Ô∏è Admin Panel loading...');
      
      if (!checkAdminSession()) return;
      
      updateTime();
      setInterval(updateTime, 1000);
      showDashboard();
      
      console.log('‚úÖ Admin Panel loaded successfully');
    };
  </script>
</body>
</html>