<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- ===== PWA META TAGS HO√ÄN CH·ªàNH ===== -->
<!-- Viewport chu·∫©n cho PWA -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<!-- PWA Manifest -->
<link rel="manifest" href="./manifest.json">

<!-- Theme colors -->
<meta name="theme-color" content="#b71c1c">
<meta name="msapplication-navbutton-color" content="#b71c1c">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<!-- Apple PWA Settings -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="eTax Mobile">

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<title>Th√¥ng tin nghi·ªáp v·ª• thu·∫ø - eTax Mobile</title>

<style>
/* ===== PWA OPTIMIZATIONS ===== */
* {
  animation-duration: 0s !important;
  transition-duration: 0s !important;
}

html, body {
  overflow: hidden !important;
  overscroll-behavior: contain;
  height: 100vh;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', 'Tahoma', 'Microsoft Sans Serif', 'Arial', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #333;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
}

/* ===== HEADER ===== */
.header {
  background: #b71c1c;
  color: white;
  padding: 15px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  height: 60px;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 15px;
}

.back-btn {
  background: none;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
  padding: 5px;
}

.header-title {
  font-size: 18px;
  font-weight: 600;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 10px;
}

.home-btn {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
}

/* ===== MAIN CONTENT ===== */
.main-container {
  margin-top: 60px;
  height: calc(100vh - 60px);
  overflow-y: auto;
  padding: 20px;
  -webkit-overflow-scrolling: touch;
}

.info-container {
  background: white;
  border-radius: 15px;
  padding: 25px;
  margin-bottom: 20px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.section-title {
  color: #b71c1c;
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 20px;
  text-align: center;
  padding-bottom: 10px;
  border-bottom: 2px solid #f0f0f0;
}

.mst-display {
  text-align: center;
  margin-bottom: 25px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 10px;
  border: 2px solid #b71c1c;
}

.mst-label {
  color: #666;
  font-size: 14px;
  margin-bottom: 5px;
}

.mst-value {
  color: #b71c1c;
  font-size: 24px;
  font-weight: bold;
}

.search-btn {
  width: 100%;
  background: #b71c1c;
  color: white;
  border: none;
  padding: 15px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  margin-bottom: 25px;
}

.search-btn:hover {
  background: #9a0e0e;
}

.info-section {
  margin-bottom: 25px;
}

.info-section h3 {
  color: #333;
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 15px;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 6px;
  border-left: 4px solid #b71c1c;
}

.info-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  margin-bottom: 15px;
}

.info-item {
  display: flex;
  flex-direction: column;
}

.info-label {
  color: #666;
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 5px;
}

.info-value {
  color: #333;
  font-size: 15px;
  font-weight: 500;
  background: #f8f9fa;
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #e0e0e0;
}

.info-value.highlight {
  background: #fff3cd;
  color: #856404;
  border-color: #ffeaa7;
}

.info-value.amount {
  background: #d4edda;
  color: #155724;
  border-color: #c3e6cb;
  font-weight: 600;
}

.full-width {
  grid-column: 1 / -1;
}

/* ===== TAX DETAILS SPECIFIC ===== */
.tax-details {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
}

.tax-item {
  padding: 15px;
  border-bottom: 1px solid #f0f0f0;
  display: grid;
  grid-template-columns: 1fr 2fr 1fr;
  gap: 10px;
  align-items: center;
}

.tax-item:last-child {
  border-bottom: none;
}

.tax-item.header {
  background: #f8f9fa;
  font-weight: 600;
  color: #333;
}

.tax-amount {
  text-align: right;
  font-weight: 600;
  color: #28a745;
}

.tax-status {
  text-align: center;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
}

.tax-status.paid {
  background: #d4edda;
  color: #155724;
}

.tax-status.pending {
  background: #fff3cd;
  color: #856404;
}

/* ===== LOADING & EMPTY STATES ===== */
.loading {
  text-align: center;
  padding: 40px;
  color: #666;
}

.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #b71c1c;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  animation: spin 1s linear infinite;
  margin: 0 auto 15px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  .info-grid {
    grid-template-columns: 1fr;
  }
  
  .tax-item {
    grid-template-columns: 1fr;
    text-align: center;
  }
  
  .main-container {
    padding: 15px;
  }
}

/* ===== PWA OVERRIDES ===== */
html {
  touch-action: pan-y;
}

body {
  touch-action: pan-y;
}

.main-container {
  touch-action: pan-y;
}
</style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <button class="back-btn" onclick="goBack()">‚Üê</button>
      <div class="header-title">Th√¥ng tin nghi·ªáp v·ª• thu·∫ø</div>
    </div>
    <div class="header-right">
      <button class="home-btn" onclick="goHome()">üè†</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-container">
    <!-- MST Info -->
    <div class="info-container">
      <h2 class="section-title">Th√¥ng tin nghi·ªáp v·ª• thu·∫ø</h2>
      
      <div class="mst-display">
        <div class="mst-label">M√£ s·ªë thu·∫ø</div>
        <div class="mst-value" id="displayMST">001095026798</div>
      </div>

      <button class="search-btn" onclick="loadTaxInfo()">
        üîç Tra c·ª©u
      </button>

      <!-- Loading State -->
      <div class="loading" id="loadingState" style="display: none;">
        <div class="spinner"></div>
        <p>ƒêang t·∫£i th√¥ng tin...</p>
      </div>

      <!-- Tax Information -->
      <div id="taxInfoContainer" style="display: none;">
        <!-- Th√¥ng tin chi ti·∫øt -->
        <div class="info-section">
          <h3>Th√¥ng tin chi ti·∫øt</h3>
          <p style="font-size: 13px; color: #666; margin-bottom: 15px; font-style: italic;">
            (C√°c kho·∫£n c√≤n ph·∫£i n·ªôp, n·ªôp th·ª´a, c√≤n ƒë∆∞·ª£c ho√†n ƒë√£ ƒë∆∞·ª£c ghi nh·∫≠n trong h·ªá th·ªëng ·ª©ng d·ª•ng qu·∫£n l√Ω thu·∫ø)
          </p>
          
          <div class="info-grid">
            <div class="info-item full-width">
              <div class="info-label">1. C√°c kho·∫£n thu·∫ø, ti·ªÅn ph·∫°t</div>
              <div class="info-value">Ph∆∞·ªùng Vƒ©nh Tuy - Thu·∫ø c∆° s·ªü 3 Th√†nh ph·ªë H√† N·ªôi</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Lo·∫°i nghi·ªáp v·ª•</div>
              <div class="info-value highlight">C√≤n ph·∫£i n·ªôp</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Ti·ªÉu m·ª•c</div>
              <div class="info-value highlight">Thu t·ª´ ƒë·∫•t ·ªü t·∫°i ƒë√¥ th·ªã (1602)</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">S·ªë ti·ªÅn</div>
              <div class="info-value amount">519,042 VND</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">G·ª£i √Ω x·ª≠ l√Ω</div>
              <div class="info-value">N·ªôp thu·∫ø Tra so√°t</div>
            </div>
          </div>
        </div>

        <!-- C√°c kho·∫£n con ph·∫£i n·ªôp -->
        <div class="info-section">
          <h3>C√°c kho·∫£n con ph·∫£i n·ªôp</h3>
          
          <div class="info-grid">
            <div class="info-item full-width">
              <div class="info-label">2. C√°c kho·∫£n ti·ªÅn ch·∫≠m n·ªôp</div>
              <div class="info-value">-</div>
            </div>
            
            <div class="info-item full-width">
              <div class="info-label">3. C√°c kho·∫£n thu kh√°c thu·ªôc NSNN tr·ª´ ti·ªÅn ch·∫≠m n·ªôp, ti·ªÅn ph·∫°t</div>
              <div class="info-value">-</div>
            </div>
          </div>
        </div>

        <!-- Chi ti·∫øt nghi·ªáp v·ª• -->
        <div class="info-section">
          <h3>Chi ti·∫øt nghi·ªáp v·ª• hi·ªán t·∫°i</h3>
          
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">ID kho·∫£n ph·∫£i n·ªôp</div>
              <div class="info-value">04055598296500001</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">S·ªë quy·∫øt ƒë·ªãnh/S·ªë th√¥ng b√°o</div>
              <div class="info-value">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Ng√†y quy·∫øt ƒë·ªãnh/Ng√†y th√¥ng b√°o</div>
              <div class="info-value">09/03/2025</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">T√™n c∆° quan thu</div>
              <div class="info-value">Ph∆∞·ªùng Vƒ©nh Tuy - Thu·∫ø c∆° s·ªü 3 Th√†nh ph·ªë H√† N·ªôi</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Ch∆∞∆°ng</div>
              <div class="info-value">757</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">K·ª≥ thu·∫ø</div>
              <div class="info-value">00/CN/2025</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Ti·ªÉu m·ª•c</div>
              <div class="info-value highlight">Thu t·ª´ ƒë·∫•t ·ªü t·∫°i ƒë√¥ th·ªã (1602)</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">ƒê·ªãa b√†n h√†nh ch√≠nh</div>
              <div class="info-value">Ph∆∞·ªùng Vƒ©nh Tuy (00283)</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">H·∫°n n·ªôp</div>
              <div class="info-value">31/10/2025</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">S·ªë ti·ªÅn</div>
              <div class="info-value amount">519,042 VND</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">S·ªë ti·ªÅn ƒë√£ n·ªôp</div>
              <div class="info-value">0 VND</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Lo·∫°i nghi·ªáp v·ª•</div>
              <div class="info-value highlight">C√≤n ph·∫£i n·ªôp</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">S·ªë tham chi·∫øu</div>
              <div class="info-value">-</div>
            </div>
            
            <div class="info-item">
              <div class="info-label">Tr·∫°ng th√°i</div>
              <div class="info-value highlight">C√°c kho·∫£n ph·∫£i n·ªôp</div>
            </div>
          </div>
        </div>

        <!-- C√°c kho·∫£n thu·∫ø ƒë√£ n·ªôp -->
        <div class="info-section">
          <h3>C√°c kho·∫£n thu·∫ø ƒë√£ n·ªôp</h3>
          
          <div class="tax-details">
            <div class="tax-item header">
              <div>Ti·ªÉu m·ª•c</div>
              <div>N·ªôi dung</div>
              <div>S·ªë ti·ªÅn</div>
            </div>
            <div class="tax-item">
              <div>1602</div>
              <div>Thu t·ª´ ƒë·∫•t ·ªü t·∫°i ƒë√¥ th·ªã</div>
              <div class="tax-amount">519,042 VND</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD_rJgBFgBulheVenQUE2KXr4PBpSpTCxw",
      authDomain: "etax-7fbf8.firebaseapp.com",
      databaseURL: "https://etax-7fbf8-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "etax-7fbf8",
      storageBucket: "etax-7fbf8.appspot.com",
      messagingSenderId: "1030026724634",
      appId: "1:1030026724634:web:d76f5f9dad43bad6fd58a3",
      measurementId: "G-YS5DLECJE6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUserMST = null;

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üìä Tax Info page loaded');
      
      // Get current user MST
      getCurrentUserMST();
      
      // Auto-load tax info
      setTimeout(() => {
        loadTaxInfo();
      }, 500);
    });

    function getCurrentUserMST() {
      // Get from session or URL parameter
      const urlParams = new URLSearchParams(window.location.search);
      const mstParam = urlParams.get('mst');
      
      if (mstParam) {
        currentUserMST = mstParam;
      } else {
        // Try to get from localStorage or session
        const session = localStorage.getItem('etax_user_session');
        if (session) {
          try {
            const sessionData = JSON.parse(session);
            currentUserMST = sessionData.mst;
          } catch (error) {
            console.error('Error parsing user session:', error);
          }
        }
      }
      
      if (!currentUserMST) {
        // Default MST for demo
        currentUserMST = '001095026798';
      }
      
      // Update display
      document.getElementById('displayMST').textContent = currentUserMST;
      
      console.log('üìä Current user MST:', currentUserMST);
    }

    async function loadTaxInfo() {
      if (!currentUserMST) {
        alert('‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin MST ng∆∞·ªùi d√πng');
        return;
      }
      
      // Show loading
      document.getElementById('loadingState').style.display = 'block';
      document.getElementById('taxInfoContainer').style.display = 'none';
      
      try {
        console.log('üìä Loading tax info for MST:', currentUserMST);
        
        // Simulate API call delay
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // For demo, show predefined tax information
        // In production, this would fetch from tax authority APIs
        displayTaxInfo();
        
      } catch (error) {
        console.error('‚ùå Error loading tax info:', error);
        alert('‚ùå L·ªói t·∫£i th√¥ng tin: ' + error.message);
        document.getElementById('loadingState').style.display = 'none';
      }
    }

    function displayTaxInfo() {
      // Hide loading
      document.getElementById('loadingState').style.display = 'none';
      
      // Show tax info
      document.getElementById('taxInfoContainer').style.display = 'block';
      
      // Scroll to results
      document.getElementById('taxInfoContainer').scrollIntoView({ 
        behavior: 'smooth',
        block: 'start'
      });
      
      console.log('‚úÖ Tax info displayed for MST:', currentUserMST);
    }

    // Navigation functions
    function goBack() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = 'index.html';
      }
    }

    function goHome() {
      window.location.href = 'index.html';
    }

    // PWA optimizations
    document.addEventListener('touchstart', function(e) {
      if (e.touches.length > 1) {
        e.preventDefault();
      }
    });

    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(e) {
      const now = (new Date()).getTime();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);
  </script>
</body>
</html>