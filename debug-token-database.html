<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eTax Mobile - Database Debug Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .debug-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        
        .debug-title {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .debug-content {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        
        .form-group {
            margin: 20px 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: monospace;
            text-transform: uppercase;
        }
        
        .btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-success { background: linear-gradient(45deg, #28a745, #1e7e34); }
        .btn-warning { background: linear-gradient(45deg, #ffc107, #e0a800); }
        .btn-danger { background: linear-gradient(45deg, #dc3545, #c82333); }
        
        .message {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        
        .status-card.error { border-left-color: #dc3545; }
        .status-card.warning { border-left-color: #ffc107; }
        
        .highlight {
            background: yellow;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ eTax Mobile - Database Debug Tool</h1>
            <p>PhÃ¡t hiá»‡n vÃ  sá»­a lá»—i token verification</p>
        </div>

        <div class="form-group">
            <label for="tokenInput">Nháº­p token cáº§n debug:</label>
            <input type="text" id="tokenInput" placeholder="VD: ETAXMCS177CA6W0V0" value="ETAXMCS177CA6W0V0">
        </div>

        <div class="form-group">
            <button class="btn" onclick="debugToken()">ğŸ” Debug Token</button>
            <button class="btn btn-success" onclick="checkDatabaseStructure()">ğŸ—„ï¸ Kiá»ƒm tra Database</button>
            <button class="btn btn-warning" onclick="fixTokenStructure()">ğŸ”§ Sá»­a Token Structure</button>
            <button class="btn btn-danger" onclick="testTokenVerification()">âœ… Test Verification</button>
        </div>

        <div id="errorMsg" class="message error"></div>
        <div id="successMsg" class="message success"></div>
        <div id="infoMsg" class="message info"></div>

        <div class="status-grid">
            <div class="status-card" id="dbConnectionStatus">
                <h4>ğŸ”— Database Connection</h4>
                <p id="dbStatus">Äang kiá»ƒm tra...</p>
            </div>
            <div class="status-card" id="tokenFoundStatus">
                <h4>ğŸ« Token TÃ¬m Tháº¥y</h4>
                <p id="tokenStatus">ChÆ°a test</p>
            </div>
            <div class="status-card" id="userFoundStatus">
                <h4>ğŸ‘¤ User LiÃªn Káº¿t</h4>
                <p id="userStatus">ChÆ°a test</p>
            </div>
            <div class="status-card" id="structureStatus">
                <h4>ğŸ“‹ Cáº¥u TrÃºc</h4>
                <p id="structStatus">ChÆ°a kiá»ƒm tra</p>
            </div>
        </div>

        <div class="debug-section">
            <div class="debug-title">ğŸ” Token Debug Results</div>
            <div class="debug-content" id="tokenDebugResults">Nháº¥n "Debug Token" Ä‘á»ƒ báº¯t Ä‘áº§u...</div>
        </div>

        <div class="debug-section">
            <div class="debug-title">ğŸ—„ï¸ Database Structure</div>
            <div class="debug-content" id="dbStructureResults">Nháº¥n "Kiá»ƒm tra Database" Ä‘á»ƒ xem cáº¥u trÃºc...</div>
        </div>

        <div class="debug-section">
            <div class="debug-title">ğŸ”§ Fix Suggestions</div>
            <div class="debug-content" id="fixSuggestions">Cháº¡y debug Ä‘á»ƒ xem gá»£i Ã½ sá»­a lá»—i...</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyD_rJgBFgBulheVenQUE2KXr4PBpSpTCxw",
            authDomain: "etax-7fbf8.firebaseapp.com",
            databaseURL: "https://etax-7fbf8-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "etax-7fbf8",
            storageBucket: "etax-7fbf8.appspot.com",
            messagingSenderId: "1030026724634",
            appId: "1:1030026724634:web:d76f5f9dad43bad6fd58a3",
            measurementId: "G-YS5DLECJE6"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let debugResults = {};

        // Kiá»ƒm tra káº¿t ná»‘i database
        async function checkDatabaseConnection() {
            try {
                await db.ref('.info/connected').once('value');
                updateStatus('dbConnectionStatus', 'success', 'âœ… Káº¿t ná»‘i thÃ nh cÃ´ng');
                return true;
            } catch (error) {
                updateStatus('dbConnectionStatus', 'error', 'âŒ Lá»—i káº¿t ná»‘i: ' + error.message);
                return false;
            }
        }

        // Debug token cá»¥ thá»ƒ
        async function debugToken() {
            const token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                showError('Vui lÃ²ng nháº­p token cáº§n debug');
                return;
            }

            showInfo('ğŸ” Äang debug token: ' + token);
            debugResults = { token, searches: [], conclusions: [] };

            // Kiá»ƒm tra káº¿t ná»‘i
            if (!(await checkDatabaseConnection())) return;

            try {
                // TÃ¬m token á»Ÿ cÃ¡c vá»‹ trÃ­ cÃ³ thá»ƒ
                const searchLocations = [
                    'deviceTokens/' + token,
                    'tokens/' + token,
                    'userTokens/' + token,
                    'device_tokens/' + token
                ];

                for (let location of searchLocations) {
                    try {
                        console.log(`ğŸ” Searching in: ${location}`);
                        const snapshot = await db.ref(location).once('value');
                        
                        const result = {
                            location,
                            exists: snapshot.exists(),
                            data: snapshot.exists() ? snapshot.val() : null
                        };

                        debugResults.searches.push(result);

                        if (snapshot.exists()) {
                            updateStatus('tokenFoundStatus', 'success', `âœ… TÃ¬m tháº¥y táº¡i: ${location}`);
                            showSuccess(`âœ… Token tÃ¬m tháº¥y táº¡i: ${location}`);
                            
                            // PhÃ¢n tÃ­ch cáº¥u trÃºc token
                            await analyzeTokenStructure(snapshot.val(), location);
                        }
                    } catch (error) {
                        debugResults.searches.push({
                            location,
                            error: error.message
                        });
                    }
                }

                // TÃ¬m kiáº¿m toÃ n bá»™ database náº¿u khÃ´ng tÃ¬m tháº¥y
                if (debugResults.searches.filter(s => s.exists).length === 0) {
                    await searchEntireDatabase(token);
                }

                // Hiá»ƒn thá»‹ káº¿t quáº£
                displayDebugResults();

            } catch (error) {
                showError('Lá»—i debug: ' + error.message);
                console.error('Debug error:', error);
            }
        }

        // PhÃ¢n tÃ­ch cáº¥u trÃºc token
        async function analyzeTokenStructure(tokenData, location) {
            console.log('ğŸ“‹ Analyzing token structure:', tokenData);
            
            const analysis = {
                location,
                structure: {},
                issues: [],
                suggestions: []
            };

            // Kiá»ƒm tra cÃ¡c field quan trá»ng
            const requiredFields = ['userId', 'status', 'createdAt', 'expiresAt'];
            const optionalFields = ['used', 'valid', 'expires_at', 'uid'];

            for (let field of requiredFields) {
                if (tokenData.hasOwnProperty(field)) {
                    analysis.structure[field] = { exists: true, value: tokenData[field] };
                } else {
                    analysis.structure[field] = { exists: false };
                    analysis.issues.push(`Missing required field: ${field}`);
                }
            }

            for (let field of optionalFields) {
                if (tokenData.hasOwnProperty(field)) {
                    analysis.structure[field] = { exists: true, value: tokenData[field] };
                }
            }

            // Kiá»ƒm tra status field
            if (tokenData.status) {
                if (!['active', 'used', 'expired'].includes(tokenData.status)) {
                    analysis.issues.push(`Invalid status value: ${tokenData.status}`);
                }
            } else if (tokenData.valid !== undefined) {
                analysis.suggestions.push('Convert "valid" field to "status" field');
            }

            // Kiá»ƒm tra userId/uid
            if (tokenData.userId) {
                await checkUserExists(tokenData.userId);
            } else if (tokenData.uid) {
                await checkUserExists(tokenData.uid);
                analysis.suggestions.push('Convert "uid" to "userId"');
            } else {
                analysis.issues.push('No user reference found');
                updateStatus('userFoundStatus', 'error', 'âŒ KhÃ´ng cÃ³ user liÃªn káº¿t');
            }

            debugResults.tokenAnalysis = analysis;
        }

        // Kiá»ƒm tra user tá»“n táº¡i
        async function checkUserExists(userId) {
            try {
                const userSnapshot = await db.ref('users/' + userId).once('value');
                if (userSnapshot.exists()) {
                    updateStatus('userFoundStatus', 'success', 'âœ… User tá»“n táº¡i: ' + userId);
                    debugResults.userFound = { exists: true, userId, data: userSnapshot.val() };
                } else {
                    updateStatus('userFoundStatus', 'error', 'âŒ User khÃ´ng tá»“n táº¡i: ' + userId);
                    debugResults.userFound = { exists: false, userId };
                }
            } catch (error) {
                updateStatus('userFoundStatus', 'error', 'âŒ Lá»—i kiá»ƒm tra user: ' + error.message);
            }
        }

        // TÃ¬m kiáº¿m toÃ n bá»™ database
        async function searchEntireDatabase(token) {
            showInfo('ğŸ” TÃ¬m kiáº¿m toÃ n bá»™ database...');
            
            try {
                // Láº¥y toÃ n bá»™ database (chá»‰ level Ä‘áº§u)
                const snapshot = await db.ref('/').once('value');
                const data = snapshot.val();
                
                const foundLocations = [];
                
                // TÃ¬m token trong táº¥t cáº£ cÃ¡c node
                function searchInObject(obj, path = '') {
                    if (typeof obj === 'object' && obj !== null) {
                        for (let key in obj) {
                            const currentPath = path ? `${path}/${key}` : key;
                            
                            if (key === token) {
                                foundLocations.push(currentPath);
                            } else if (typeof obj[key] === 'object') {
                                searchInObject(obj[key], currentPath);
                            }
                        }
                    }
                }
                
                searchInObject(data);
                
                debugResults.fullSearch = {
                    performed: true,
                    foundLocations
                };
                
                if (foundLocations.length > 0) {
                    showSuccess(`ğŸ¯ Token tÃ¬m tháº¥y táº¡i: ${foundLocations.join(', ')}`);
                    updateStatus('tokenFoundStatus', 'success', `âœ… TÃ¬m tháº¥y ${foundLocations.length} vá»‹ trÃ­`);
                } else {
                    showError('âŒ Token khÃ´ng tá»“n táº¡i trong database');
                    updateStatus('tokenFoundStatus', 'error', 'âŒ Token khÃ´ng tá»“n táº¡i');
                }
                
            } catch (error) {
                showError('Lá»—i tÃ¬m kiáº¿m database: ' + error.message);
            }
        }

        // Kiá»ƒm tra cáº¥u trÃºc database
        async function checkDatabaseStructure() {
            showInfo('ğŸ—„ï¸ Äang kiá»ƒm tra cáº¥u trÃºc database...');
            
            try {
                const structure = {};
                const mainNodes = ['users', 'tokens', 'deviceTokens', 'device_tokens', 'userTokens'];
                
                for (let node of mainNodes) {
                    try {
                        const snapshot = await db.ref(node).once('value');
                        if (snapshot.exists()) {
                            const data = snapshot.val();
                            const keys = Object.keys(data);
                            
                            structure[node] = {
                                exists: true,
                                count: keys.length,
                                sampleKeys: keys.slice(0, 3),
                                sampleData: data[keys[0]] || null
                            };
                        } else {
                            structure[node] = { exists: false };
                        }
                    } catch (error) {
                        structure[node] = { error: error.message };
                    }
                }
                
                document.getElementById('dbStructureResults').textContent = JSON.stringify(structure, null, 2);
                updateStatus('structureStatus', 'success', 'âœ… ÄÃ£ kiá»ƒm tra cáº¥u trÃºc');
                showSuccess('âœ… ÄÃ£ kiá»ƒm tra cáº¥u trÃºc database');
                
            } catch (error) {
                showError('Lá»—i kiá»ƒm tra cáº¥u trÃºc: ' + error.message);
            }
        }

        // Sá»­a cáº¥u trÃºc token
        async function fixTokenStructure() {
            const token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                showError('Vui lÃ²ng nháº­p token cáº§n sá»­a');
                return;
            }

            showInfo('ğŸ”§ Äang sá»­a cáº¥u trÃºc token...');
            
            // Thá»±c hiá»‡n debug trÆ°á»›c
            await debugToken();
            
            if (!debugResults.tokenAnalysis) {
                showError('KhÃ´ng tÃ¬m tháº¥y token Ä‘á»ƒ sá»­a');
                return;
            }

            try {
                const analysis = debugResults.tokenAnalysis;
                const currentData = debugResults.searches.find(s => s.exists)?.data;
                
                if (!currentData) {
                    showError('KhÃ´ng tÃ¬m tháº¥y dá»¯ liá»‡u token');
                    return;
                }

                // Táº¡o cáº¥u trÃºc má»›i chuáº©n
                const fixedData = {
                    userId: currentData.userId || currentData.uid,
                    status: currentData.status || (currentData.valid ? 'active' : 'used'),
                    createdAt: currentData.createdAt || currentData.created_at || Date.now(),
                    expiresAt: currentData.expiresAt || currentData.expires_at,
                    token: token,
                    deviceId: currentData.deviceId || null,
                    usedAt: currentData.usedAt || null
                };

                // LÆ°u vÃ o vá»‹ trÃ­ chuáº©n
                await db.ref('deviceTokens/' + token).set(fixedData);
                
                showSuccess('âœ… ÄÃ£ sá»­a cáº¥u trÃºc token thÃ nh cÃ´ng!');
                
                // Test láº¡i
                setTimeout(() => testTokenVerification(), 1000);
                
            } catch (error) {
                showError('Lá»—i sá»­a token: ' + error.message);
            }
        }

        // Test token verification
        async function testTokenVerification() {
            const token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                showError('Vui lÃ²ng nháº­p token cáº§n test');
                return;
            }

            showInfo('âœ… Äang test token verification...');
            
            try {
                // Thá»±c hiá»‡n logic giá»‘ng token-login.html
                const tokenSnapshot = await db.ref('deviceTokens/' + token).once('value');
                
                if (!tokenSnapshot.exists()) {
                    showError('âŒ Token khÃ´ng tá»“n táº¡i');
                    return;
                }

                const tokenData = tokenSnapshot.val();
                const results = {
                    tokenExists: true,
                    tokenData,
                    checks: {}
                };

                // Check expiration
                if (tokenData.expiresAt && Date.now() > tokenData.expiresAt) {
                    results.checks.expiration = { passed: false, message: 'Token Ä‘Ã£ háº¿t háº¡n' };
                } else {
                    results.checks.expiration = { passed: true, message: 'Token cÃ²n háº¡n' };
                }

                // Check status
                if (tokenData.status !== 'active') {
                    results.checks.status = { passed: false, message: `Status: ${tokenData.status}` };
                } else {
                    results.checks.status = { passed: true, message: 'Status: active' };
                }

                // Check user
                const userSnapshot = await db.ref('users/' + tokenData.userId).once('value');
                if (!userSnapshot.exists()) {
                    results.checks.user = { passed: false, message: 'User khÃ´ng tá»“n táº¡i' };
                } else {
                    results.checks.user = { passed: true, message: 'User tá»“n táº¡i', userData: userSnapshot.val() };
                }

                results.overallResult = Object.values(results.checks).every(check => check.passed);

                // Hiá»ƒn thá»‹ káº¿t quáº£
                const resultText = `
VERIFICATION TEST RESULTS:
=========================
Token: ${token}
Overall Result: ${results.overallResult ? 'âœ… PASS' : 'âŒ FAIL'}

Detailed Checks:
${Object.entries(results.checks).map(([key, check]) => 
    `- ${key}: ${check.passed ? 'âœ…' : 'âŒ'} ${check.message}`
).join('\n')}

Token Data:
${JSON.stringify(tokenData, null, 2)}
                `;

                document.getElementById('tokenDebugResults').textContent = resultText;

                if (results.overallResult) {
                    showSuccess('ğŸ‰ Token verification test PASSED!');
                } else {
                    showError('âŒ Token verification test FAILED!');
                }

            } catch (error) {
                showError('Lá»—i test verification: ' + error.message);
            }
        }

        // Hiá»ƒn thá»‹ káº¿t quáº£ debug
        function displayDebugResults() {
            const results = `
DEBUG RESULTS FOR TOKEN: ${debugResults.token}
=============================================

Search Results:
${debugResults.searches.map(search => `
- Location: ${search.location}
- Exists: ${search.exists}
- Data: ${search.data ? JSON.stringify(search.data, null, 2) : 'null'}
- Error: ${search.error || 'none'}
`).join('\n')}

${debugResults.tokenAnalysis ? `
Token Analysis:
- Location: ${debugResults.tokenAnalysis.location}
- Issues: ${debugResults.tokenAnalysis.issues.join(', ') || 'none'}
- Suggestions: ${debugResults.tokenAnalysis.suggestions.join(', ') || 'none'}
- Structure: ${JSON.stringify(debugResults.tokenAnalysis.structure, null, 2)}
` : ''}

${debugResults.userFound ? `
User Check:
- Exists: ${debugResults.userFound.exists}
- User ID: ${debugResults.userFound.userId}
- Data: ${debugResults.userFound.data ? JSON.stringify(debugResults.userFound.data, null, 2) : 'null'}
` : ''}

${debugResults.fullSearch ? `
Full Database Search:
- Found Locations: ${debugResults.fullSearch.foundLocations.join(', ') || 'none'}
` : ''}
            `;

            document.getElementById('tokenDebugResults').textContent = results;

            // Táº¡o gá»£i Ã½ sá»­a lá»—i
            generateFixSuggestions();
        }

        // Táº¡o gá»£i Ã½ sá»­a lá»—i
        function generateFixSuggestions() {
            const suggestions = [];

            if (debugResults.searches.filter(s => s.exists).length === 0) {
                suggestions.push('âŒ TOKEN KHÃ”NG Tá»’N Táº I - Cáº§n táº¡o token má»›i trong Admin Panel');
            } else {
                const foundToken = debugResults.searches.find(s => s.exists);
                const tokenData = foundToken.data;

                if (!tokenData.userId && !tokenData.uid) {
                    suggestions.push('ğŸ”§ Thiáº¿u user reference - Cáº§n thÃªm userId');
                }

                if (!tokenData.status) {
                    if (tokenData.valid !== undefined) {
                        suggestions.push('ğŸ”§ Convert "valid" field thÃ nh "status" field');
                    } else {
                        suggestions.push('ğŸ”§ Thiáº¿u status field - Cáº§n thÃªm status: "active"');
                    }
                }

                if (tokenData.expires_at && !tokenData.expiresAt) {
                    suggestions.push('ğŸ”§ Convert "expires_at" thÃ nh "expiresAt"');
                }

                if (debugResults.userFound && !debugResults.userFound.exists) {
                    suggestions.push('âŒ User khÃ´ng tá»“n táº¡i - Cáº§n táº¡o user hoáº·c fix userId');
                }

                if (foundToken.location !== 'deviceTokens/' + debugResults.token) {
                    suggestions.push('ğŸ”§ Token khÃ´ng á»Ÿ Ä‘Ãºng location chuáº©n - Cáº§n move vá» deviceTokens');
                }
            }

            if (suggestions.length === 0) {
                suggestions.push('âœ… Token structure looks good! CÃ³ thá»ƒ cÃ³ váº¥n Ä‘á» khÃ¡c.');
            }

            const suggestionText = `
FIX SUGGESTIONS:
================
${suggestions.join('\n')}

RECOMMENDED ACTIONS:
====================
1. Nháº¥n "ğŸ”§ Sá»­a Token Structure" Ä‘á»ƒ auto-fix
2. Nháº¥n "âœ… Test Verification" Ä‘á»ƒ kiá»ƒm tra
3. Náº¿u váº«n lá»—i, táº¡o token má»›i trong Admin Panel
            `;

            document.getElementById('fixSuggestions').textContent = suggestionText;
        }

        // Helper functions
        function updateStatus(elementId, type, message) {
            const element = document.getElementById(elementId);
            const status = element.querySelector('p');
            status.textContent = message;
            
            element.className = 'status-card';
            if (type === 'success') element.classList.add('success');
            if (type === 'error') element.classList.add('error');
            if (type === 'warning') element.classList.add('warning');
        }

        function showError(message) {
            hideMessages();
            const errorMsg = document.getElementById('errorMsg');
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
            console.error(message);
        }

        function showSuccess(message) {
            hideMessages();
            const successMsg = document.getElementById('successMsg');
            successMsg.textContent = message;
            successMsg.style.display = 'block';
            console.log(message);
        }

        function showInfo(message) {
            hideMessages();
            const infoMsg = document.getElementById('infoMsg');
            infoMsg.textContent = message;
            infoMsg.style.display = 'block';
            console.info(message);
        }

        function hideMessages() {
            document.getElementById('errorMsg').style.display = 'none';
            document.getElementById('successMsg').style.display = 'none';
            document.getElementById('infoMsg').style.display = 'none';
        }

        // Khá»Ÿi táº¡o
        window.addEventListener('load', async () => {
            console.log('ğŸš€ Debug Tool loaded successfully');
            await checkDatabaseConnection();
            showInfo('ğŸ’¡ Nháº­p token vÃ  nháº¥n "Debug Token" Ä‘á»ƒ báº¯t Ä‘áº§u phÃ¢n tÃ­ch');
        });

        // Auto debug khi nháº­p token
        document.getElementById('tokenInput').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
        });

        // Enter key trigger
        document.getElementById('tokenInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                debugToken();
            }
        });

        console.log('ğŸ”§ eTax Mobile Debug Tool initialized');
    </script>
</body>
</html>